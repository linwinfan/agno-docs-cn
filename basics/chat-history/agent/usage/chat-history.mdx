---
title: 聊天历史管理
---

本示例演示了如何在智能体对话中管理和检索聊天历史，从而能够访问之前的对话消息和上下文。

## 代码

```python chat_history.py
from agno.agent.agent import Agent
from agno.db.postgres import PostgresDb
from agno.models.openai import OpenAIChat

db_url = "postgresql+psycopg://ai:ai@localhost:5532/ai"

db = PostgresDb(db_url=db_url, session_table="sessions")

agent = Agent(
    model=OpenAIChat(id="gpt-5-mini"),
    db=db,
    session_id="chat_history",
    instructions="您是一个乐于助人的助手，可以回答有关太空和海洋的问题。",
    add_history_to_context=True,
)

agent.print_response("告诉我一个关于太空的有趣新事实")
print(agent.get_chat_history())

agent.print_response("告诉我一个关于海洋的有趣新事实")
print(agent.get_chat_history())
```

## 使用方法

<Steps>
  <Snippet file="create-venv-step.mdx" />

  <Step title="安装库">
    ```bash
    pip install -U agno openai psycopg
    ```
  </Step>

  <Step title="设置 PostgreSQL">
    ```bash
    # 确保 PostgreSQL 正在运行
    # 根据需要更新代码中的连接字符串
    ```
  </Step>

  <Step title="导出您的 OpenAI API 密钥">

    <CodeGroup>

    ```bash Mac/Linux
      export OPENAI_API_KEY="your_openai_api_key_here"
    ```

    ```bash Windows
      $Env:OPENAI_API_KEY="your_openai_api_key_here"
    ```
    </CodeGroup>
  </Step>

  <Step title="创建 Python 文件">
    创建一个 Python 文件并添加上述代码。
    ```bash
    touch chat_history.py
    ```
  </Step>

  <Step title="运行智能体">
    <CodeGroup>
    ```bash Mac
    python chat_history.py
    ```

    ```bash Windows
    python chat_history.py
    ```
    </CodeGroup>
  </Step>

  <Step title="查找所有示例">
  探索 Agno 仓库中所有可用的示例。点击下面的链接在 GitHub 上查看代码：

  <Link href="https://github.com/agno-agi/agno/tree/main/cookbook/03_agents/session" target="_blank">
    Agno 示例代码库 (GitHub)
  </Link>
</Step>
</Steps>