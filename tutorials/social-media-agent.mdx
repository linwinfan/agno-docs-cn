---
title: 使用 Agno、X Tools 和 Exa 构建社交媒体智能代理
sidebarTitle: 社交媒体代理
description: 使用 Agno 创建专业级的社交媒体智能系统。
---

在本教程中，我们将构建一个多代理智能系统。它将监控 X（Twitter），执行情感分析，并使用 Agno 框架生成报告。

我们将使用以下组件：

- **Agno** - 构建代理的最快框架。
- **X Tools** - 直接从 Twitter/X API 提供实时、结构化数据，包含参与度指标
- **Exa Tools** - 提供语义网络搜索，在博客、论坛和新闻中发现更广泛的背景信息
- **GPT-5 Mini** - OpenAI 的新模型。非常适合上下文感知的情感分析和战略模式检测

该系统将把直接的社交媒体数据与更广泛的网络智能相结合，提供全面的品牌监控，既捕获即时的社交情感，也捕获在进入主流关注之前的新兴讨论。

## 您将构建的内容

您的社交媒体智能系统将：

- 在 X 和更广泛的网络上跟踪品牌和竞争对手提及
- 执行考虑影响力和参与度的加权情感分析
- 检测病毒式内容、争议信号和高影响力讨论
- 生成包含战略建议的执行层就绪报告
- 通过 [AgentOS](/agent-os/introduction) API 提供洞察，以便与您的应用程序集成

## 先决条件和设置

在开始之前，我们需要设置我们的环境：

1. 安装 Python、Git 并获取您的 API 密钥：

- 安装 **Python >= 3.9** 和 **Git**
- 获取以下 API 密钥：
    - **X (Twitter) 开发者账户** ([在此申请](https://developer.twitter.com/en/apply-for-access))
    - **OpenAI API** ([获取密钥](https://platform.openai.com/api-keys))
    - **Exa API** ([注册](https://exa.ai))

2. 设置您的 Python 环境：

```bash
mkdir social-intel && cd social-intel
python3 -m venv venv
source venv/bin/activate     # 如果您在 Windows 上，使用：venv\Scripts\activate
```

3. 安装我们的 Python 依赖：

```bash
# 安装依赖
pip install "agno[infra]" openai exa_py python-dotenv

4. 使用 [AgentOS](/agent-os/introduction) 创建新项目：

```bash
ag infra create              # 选择：[1] agent-infra-docker（默认）
# 基础设施名称：social-intel
```

5. 设置您的环境变量：

```env
export OPENAI_API_KEY=sk-your-openai-api-key-here
export X_API_KEY=your-x-api-key
export X_API_SECRET=your-x-api-secret
export X_ACCESS_TOKEN=your-access-token
export X_ACCESS_TOKEN_SECRET=your-access-token-secret
export X_BEARER_TOKEN=your-bearer-token
export EXA_API_KEY=your-exa-api-key
```

我们的环境现在准备就绪。让我们开始构建吧！

# 构建我们的社交媒体智能系统

## 步骤 1：选择您的 AI 模型

**我应该使用哪个模型？**：您可以从我们支持的提供商中选择任何模型。通常模型是基于成本和性能来选择的。在本例中，我们将使用 OpenAI 的 GPT-5 Mini。

**为什么选择 GPT-5 Mini？**
- **成本效益**：比其他 GPT 模型具有更好的性价比
- **工具使用**：擅长决定何时以及如何使用工具
- **复杂推理**：可以遵循详细的分析方法
- **结构化输出**：在生成格式化报告方面可靠

让我们首先创建定义代理的文件：

```bash
mkdir -p app
touch app/social_media_agent.py
```

现在让我们添加基本的导入和模型设置：

```python
from pathlib import Path
from dotenv import load_dotenv
from agno.models.openai import OpenAIChat

# 加载基础设施密钥
load_dotenv(dotenv_path=Path(__file__).resolve().parents[1] / "infra" / "secrets" / ".env")

# 为您的代理选择 AI 模型
model = OpenAIChat(id="gpt-5-mini")
print(f"Model selected: {model.id}")
```

现在我们可以测试我们的模型设置：

```python
# 快速测试以验证模型工作
if __name__ == "__main__":
    test_response = model.invoke("Explain social media sentiment analysis in one sentence.")
    print(f"Model test: {test_response}")
```

这确认了您的模型正常工作，然后我们再添加更多复杂性。

## 步骤 2：添加社交媒体工具

**我应该使用哪些工具？** 我们添加 XTools 是因为我们需要带有参与度指标的直接 Twitter/X 数据，添加 ExaTools 是因为我们需要社交媒体本身无法提供的更广泛的网络背景。

### 2a. 为 Twitter/X 数据添加 XTools

**为什么选择 XTools？** 直接访问带有参与度指标的 Twitter/X 对于理解影响模式和病毒式内容至关重要。

```python
from agno.tools.x import XTools

# 为社交媒体数据配置 X Tools
x_tools = XTools(
    include_post_metrics=True,    # 关键：获取点赞、转发、回复用于影响力分析
    wait_on_rate_limit=True,      # 优雅地处理 API 限制
)

print("XTools configured with post metrics enabled")
```

**`include_post_metrics=True` 为您提供什么：**
- 点赞数（参与度数量）
- 转发数（病毒式传播）
- 回复数（对话深度）
- 作者验证状态（影响力权重）

### 2b. 为网络智能添加 ExaTools

**为什么选择 ExaTools？** 社交媒体讨论经常引用网络上发生的更广泛对话。ExaTools 找到这个背景。

```python
from agno.tools.exa import ExaTools

# 为更广泛的网络智能配置 Exa
exa_tools = ExaTools(
    num_results=10,               # 全面但不过量
    include_domains=["reddit.com", "news.ycombinator.com", "medium.com"],
)

print("ExaTools configured for web search")
```

**为什么选择这些特定域名？**
- **Reddit**：早期讨论指标，社区情感
- **HackerNews**：科技行业洞察，开发者意见
- **Medium**：思想领导力，分析文章

## 步骤 3：定义智能策略

**为什么我们需要指令？** 我们需要描述代理应该采取的收集和分析内容的策略。没有明确的指令，代理将不知道如何有效使用工具或提供什么样的分析。

### 3a. 定义数据收集策略

```python
from textwrap import dedent

# 定义代理应该如何收集数据
data_collection_strategy = dedent("""
    数据收集策略：
    - 使用 X Tools 收集直接社交媒体提及和完整参与度指标
    - 使用 Exa Tools 找到更广泛的网络讨论、文章和论坛对话
    - 在社交和网络源之间交叉引用发现以实现全面覆盖
""")

print("Data collection strategy defined")
```

### 3b. 定义分析框架

```python
# 定义代理应该如何分析数据
analysis_framework = dedent("""
    分析框架：
    - 将情感分类为正面/负面/中性/混合并提供详细推理
    - 按参与度数量和作者影响力加权分析（验证账户 = 1.5x）
    - 识别参与模式：病毒式支持、争议、影响力集中
    - 提取跨平台主题和重复讨论点
""")

print("Analysis framework defined")
```

### 3c. 定义智能综合

```python
# 定义如何将分析转化为可操作的洞察
intelligence_synthesis = dedent("""
    智能综合：
    - 通过情感速度和协调模式检测危机指标
    - 识别竞争定位和功能差距讨论
    - 发现增长机会和支持时刻
    - 生成具有明确优先级的战略建议
""")

print("Intelligence synthesis defined")
```

### 3d. 定义报告格式

```python
# 定义预期的输出结构
report_format = dedent("""
    报告格式：

    ### 执行仪表板
    - **品牌健康分数**：[1-10] 并附支持证据
    - **净情感**：[%正面 - %负面] 并附趋势分析
    - **关键驱动因素**：前3个正面和负面因素
    - **警报级别**：正常/监控/危机 并附阈值推理

    ### 定量指标
    | 情感 | 帖子 | % | 平均参与度 | 影响力分数 |
    |-----------|-------|---|----------------|-----------------|
    [按参与度加权的详细细分]

    ### 战略建议
    **立即（≤48小时）**：危机响应、高影响力回复
    **短期（1-2周）**：内容策略、社区参与
    **长期（1-3个月）**：产品定位、市场策略
""")

print("Report format defined")
```

### 3e. 定义分析原则

```python
# 定义分析的质量标准
analysis_principles = dedent("""
    分析原则：
    - 基于证据的结论并附支持指标
    - 推动业务决策的可操作洞察
    - 跨平台相关分析
    - 影响力加权的情感评分
    - 主动的风险和机会识别
""")

print("Analysis principles defined")
```

### 3f. 组合成完整指令

```python
# 组合所有指令组件
complete_instructions = f"""
您是一位专门从事跨平台品牌监控和战略分析的高级社交媒体智能分析师。

核心方法论：

{data_collection_strategy}

{analysis_framework}

{intelligence_synthesis}

{report_format}

{analysis_principles}
"""

print(f"Complete instructions created: {len(complete_instructions)} characters")
```

## 步骤 4：创建完整的代理

现在让我们将所有部分组合起来 - 模型、工具和指令 - 来创建您完整的社交媒体智能代理。

### 4a. 创建代理

```python
from agno.agent import Agent

# 将模型、工具和指令组合成一个完整的代理
social_media_agent = Agent(
    name="Social Media Intelligence Analyst",
    model=model,                 # 我们选择的 GPT-5 mini 模型
    tools=tools,                 # 我们配置的 X 和 Exa 工具
    instructions=complete_instructions,  # 我们定义的策略
    markdown=True,               # 为报告启用丰富格式
    show_tool_calls=True,        # 在数据收集中显示透明度
)

print(f"Agent created: {social_media_agent.name}")
```

有关每个代理参数的详细信息，请参阅 [代理参考文档](/reference/agents/agent)。

### 4b. 创建分析函数

```python
def analyze_brand_sentiment(query: str, tweet_count: int = 20):
    """
    执行全面的社交媒体智能分析。

    Args:
        query: 品牌或主题搜索查询（例如 "Tesla OR @elonmusk"）
        tweet_count: 要分析的最近推文数量
    """

    # 为代理创建详细的提示
    analysis_prompt = f"""
    为以下内容执行全面的社交媒体智能分析："{query}"

    分析参数：
    - Twitter 分析：{tweet_count} 条最近的推文并附参与度指标
    - 网络智能：通过 Exa 获取相关文章、讨论和更广泛的背景
    - 跨平台综合：将社交情感与网络讨论相关联
    - 战略重点：品牌定位、竞争分析、风险评估

    方法论：
    1. 收集直接社交媒体提及和参与度数据
    2. 搜索相关网络讨论和更广泛的背景
    3. 分析情感模式和参与度指标
    4. 识别跨平台主题和影响力网络
    5. 生成有证据支持的战略建议

    按照结构化格式提供全面的智能报告。
    """

    # 执行分析
    return social_media_agent.print_response(analysis_prompt, stream=True)

print("Analysis function created")
```

### 4c. 创建测试函数

```python
def test_agent():
    """使用示例查询测试完整代理。"""
    print("Testing social media intelligence agent...")
    analyze_brand_sentiment("Agno OR AgnoAGI", tweet_count=10)

print("Test function ready")
```

### 4d. 完整的工作示例

这是您完整的 `app/social_media_agent.py` 文件：

```python
"""
完整的社交媒体智能代理
使用 Agno 框架构建
"""
from pathlib import Path
from textwrap import dedent
from dotenv import load_dotenv

from agno.agent import Agent
from agno.models.openai import OpenAIChat
from agno.tools.x import XTools
from agno.tools.exa import ExaTools

# 加载基础设施密钥
load_dotenv(dotenv_path=Path(__file__).resolve().parents[1] / "infra" / "secrets" / ".env")

# 步骤 1：选择 AI 模型
model = OpenAIChat(id="gpt-5-mini")

# 步骤 2：配置工具
tools = [
    XTools(
        include_post_metrics=True,
        wait_on_rate_limit=True,
    ),
    ExaTools(
        num_results=10,
        include_domains=["reddit.com", "news.ycombinator.com", "medium.com"],
        exclude_domains=["spam-site.com"],
    )
]

# 步骤 3：定义指令
complete_instructions = dedent("""
    您是一位专门从事跨平台品牌监控和战略分析的高级社交媒体智能分析师。

    核心方法论：

    数据收集策略：
    - 使用 X Tools 收集直接社交媒体提及和完整参与度指标
    - 使用 Exa Tools 找到更广泛的网络讨论、文章和论坛对话
    - 在社交和网络源之间交叉引用发现以实现全面覆盖

    分析框架：
    - 将情感分类为正面/负面/中性/混合并提供详细推理
    - 按参与度数量和作者影响力加权分析（验证账户 = 1.5x）
    - 识别参与模式：病毒式支持、争议、影响力集中
    - 提取跨平台主题和重复讨论点

    智能综合：
    - 通过情感速度和协调模式检测危机指标
    - 识别竞争定位和功能差距讨论
    - 发现增长机会和支持时刻
    - 生成具有明确优先级的战略建议

    报告格式：

    ### 执行仪表板
    - **品牌健康分数**：[1-10] 并附支持证据
    - **净情感**：[%正面 - %负面] 并附趋势分析
    - **关键驱动因素**：前3个正面和负面因素
    - **警报级别**：正常/监控/危机 并附阈值推理

    ### 定量指标
    | 情感 | 帖子 | % | 平均参与度 | 影响力分数 |
    |-----------|-------|---|----------------|-----------------|
    [按参与度加权的详细细分]

    ### 战略建议
    **立即（≤48小时）**：危机响应、高影响力回复
    **短期（1-2周）**：内容策略、社区参与
    **长期（1-3个月）**：产品定位、市场策略

    分析原则：
    - 基于证据的结论并附支持指标
    - 推动业务决策的可操作洞察
    - 跨平台相关分析
    - 影响力加权的情感评分
    - 主动的风险和机会识别
""")

# 步骤 4：创建完整的代理
social_media_agent = Agent(
    name="Social Media Intelligence Analyst",
    model=model,
    tools=tools,
    instructions=complete_instructions,
    markdown=True,
    show_tool_calls=True,
)

def analyze_brand_sentiment(query: str, tweet_count: int = 20):
    """执行全面的社交媒体智能分析。"""
    prompt = f"""
    为以下内容执行全面的社交媒体智能分析："{query}"

    分析参数：
    - Twitter 分析：{tweet_count} 条最近的推文并附参与度指标
    - 网络智能：通过 Exa 获取相关文章、讨论和更广泛的背景
    - 跨平台综合：将社交情感与网络讨论相关联
    - 战略重点：品牌定位、竞争分析、风险评估

    方法论：
    1. 收集直接社交媒体提及和参与度数据
    2. 搜索相关网络讨论和更广泛的背景
    3. 分析情感模式和参与度指标
    4. 识别跨平台主题和影响力网络
    5. 生成有证据支持的战略建议

    按照结构化格式提供全面的智能报告。
    """

    return social_media_agent.print_response(prompt, stream=True)

if __name__ == "__main__":
    # 测试完整的代理
    analyze_brand_sentiment("Agno OR AgnoAGI", tweet_count=25)
```

### 4e. 为我们的项目启动基础设施：

现在我们已经完成了代理，我们可以为我们的项目启动基础设施：

```bash
ag infra up
```

您的 [AgentOS](/agent-os/introduction) API 现在正在运行。我们准备好开始构建了！


### 4f. 测试您的完整代理

```bash
python app/social_media_agent.py
```

您应该看到您的代理：
1. **使用 X Tools** 收集带有参与度指标的 Twitter 数据
2. **使用 Exa Tools** 找到更广泛的网络背景
3. **生成结构化报告** 按照您定义的格式
4. **提供战略建议** 基于分析

## 步骤 5：通过 AgentOS 测试和实验

**为什么选择 API 优先？** AgentOS 基础设施自动将您的代理公开为 REST API，使其准备好进行生产集成，无需额外的部署工作。

您的代理通过 AgentOS API 自动可用。让我们测试它！

**找到您的 API 端点：**
```bash
# 您的 AgentOS API 正在 localhost:7777 上运行
curl http://localhost:7777/v1/agents
```

**使用 Postman 或 curl 测试：**

```bash
curl -X POST http://localhost:7777/v1/agents/social_media_agent/runs \
  -H "Content-Type: application/json" \
  -d '{
    "message": "Analyze social media sentiment for: Tesla OR @elonmusk",
    "stream": false
  }'
```

**预期响应结构：**
```json
{
  "run_id": "run_123",
  "content": "### Executive Dashboard\n- **Brand Health Score**: 7.2/10...",
  "metrics": {
    "tokens_used": 1250,
    "tools_called": ["x_tools", "exa_tools"],
    "analysis_time": "23.4s"
  }
}
```

## 下一步

您的社交媒体智能系统现在已经上线，具有生产就绪的 API！考虑以下可能的下一步来扩展此系统：

- **专业化代理**：创建用于危机检测、竞争分析或影响者识别的专注代理
- **警报集成**：将 webhook 连接到 Slack、电子邮件或您现有的监控系统
- **可视化分析**：构建使用 API 的仪表板用于执行报告
- **多品牌监控**：扩展以同时监控多个品牌或竞争对手

## 结论

您已经构建了一个全面的社交媒体智能系统，它：

- 将直接的社交数据与更广泛的网络智能相结合
- 提供加权情感分析和战略建议
- 通过生产就绪的 AgentOS API 提供洞察
- 从开发到企业部署的扩展

这展示了 Agno 的基础设施优先方法，您的 AI 代理成为立即可部署的服务，内置适当的监控、扩展和集成能力。