---
title: 工作流
sidebarTitle: 工作流
mode: wide
---

## 参数

| 参数                   | 类型                                                | 默认值     | 描述                                                                                                                                             |
| --------------------------- | --------------------------------------------------- | ---------- | ----------------------------------------------------------------------------------------------------------------------------------------------- |
| `name`                      | `Optional[str]`                                     | `None`     | 工作流名称                                                                                                                                       |
| `id`                        | `Optional[str]`                                     | `None`     | 工作流 ID（如果未设置则自动生成）                                                                                                                |
| `description`               | `Optional[str]`                                     | `None`     | 工作流描述                                                                                                                                       |
| `steps`                     | `Optional[WorkflowSteps]`                           | `None`     | 工作流步骤 - 可以是可调用函数、Steps 对象或步骤列表                                                                                              |
| `db`                        | `Optional[BaseDb]`                                  | `None`     | 用于此工作流的数据库                                                                                                                             |
| `session_id`                | `Optional[str]`                                     | `None`     | 用于此工作流的默认 session_id（如果未设置则自动生成）                                                                                            |
| `user_id`                   | `Optional[str]`                                     | `None`     | 用于此工作流的默认 user_id                                                                                                                       |
| `session_state`             | `Optional[Dict[str, Any]]`                          | `None`     | 默认会话状态（存储在数据库中以在运行之间持久化）                                                                                                 |
| `debug_mode`                | `Optional[bool]`                                    | `False`    | 如果为 True，工作流在调试模式下运行                                                                                                              |
| `stream`                    | `Optional[bool]`                                    | `None`     | 从工作流流式传输响应                                                                                                                             |
| `stream_events` | `bool`                                              | `False`    | 从工作流流式传输中间步骤                                                                                                                         |
| `stream_executor_events`    | `bool`                                              | `True`     | 将步骤执行器发出的事件（代理/团队事件）与工作流事件一起流式传输                                                                                  |
| `store_events`              | `bool`                                              | `False`    | 在运行响应上持久化事件                                                                                                                           |
| `events_to_skip`            | `Optional[List[Union[WorkflowRunEvent, RunEvent, TeamRunEvent]]]` | `None`     | 在运行响应上持久化事件时要跳过的事件                                                                                                             |
| `store_executor_outputs`    | `bool`                                              | `True`     | 控制是否在扁平化运行中存储执行器响应（代理/团队响应）                                                                                            |
| `websocket_handler`         | `Optional[WebSocketHandler]`                        | `None`     | 用于实时通信的 WebSocket 处理器                                                                                                                  |
| `input_schema`              | `Optional[Type[BaseModel]]`                         | `None`     | 用于验证工作流输入的输入模式                                                                                                                     |
| `metadata`                  | `Optional[Dict[str, Any]]`                          | `None`     | 与此工作流一起存储的元数据                                                                                                                       |
| `add_workflow_history_to_steps` | `bool`                                              | `False`    | 如果为 True，将工作流历史记录添加到步骤中                                                                                                        |
| `num_history_runs`          | `int`                                               | `None`     | 要包含在工作流历史记录中的运行数量，如果未提供，则包含所有历史运行                                                                                |
| `cache_session`             | `bool`                                              | `False`    | 如果为 True，在内存中缓存当前工作流会话以更快访问                                                                                                |
| `telemetry`                 | `bool`                                              | `True`     | 记录最少的遥测数据用于分析                                                                                                                       |


## Functions

### `run`

Execute the workflow synchronously with optional streaming.

**Parameters:**

- `input` (Optional[Union[str, Dict[str, Any], List[Any], BaseModel]]): The input to send to the workflow
- `additional_data` (Optional[Dict[str, Any]]): Additional data to include with the input
- `user_id` (Optional[str]): User ID to use
- `session_id` (Optional[str]): Session ID to use
- `session_state` (Optional[Dict[str, Any]]): Session state to use
- `audio` (Optional[List[Audio]]): Audio files to include
- `images` (Optional[List[Image]]): Image files to include
- `videos` (Optional[List[Video]]): Video files to include
- `files` (Optional[List[File]]): Files to include
- `stream` (bool): Whether to stream the response
- `stream_events` (Optional[bool]): Whether to stream intermediate steps

**Returns:**

- `Union[WorkflowRunOutput, Iterator[WorkflowRunOutputEvent]]`: Either a WorkflowRunOutput or an iterator of WorkflowRunOutputEvents, depending on the `stream` parameter

### `arun`

Execute the workflow asynchronously with optional streaming.

**Parameters:**

- `input` (Optional[Union[str, Dict[str, Any], List[Any], BaseModel, List[Message]]]): The input to send to the workflow
- `additional_data` (Optional[Dict[str, Any]]): Additional data to include with the input
- `user_id` (Optional[str]): User ID to use
- `session_id` (Optional[str]): Session ID to use
- `session_state` (Optional[Dict[str, Any]]): Session state to use
- `audio` (Optional[List[Audio]]): Audio files to include
- `images` (Optional[List[Image]]): Image files to include
- `videos` (Optional[List[Video]]): Video files to include
- `files` (Optional[List[File]]): Files to include
- `stream` (bool): Whether to stream the response
- `stream_events` (Optional[bool]): Whether to stream intermediate steps
- `background` (Optional[bool]): Whether to run in background
- `websocket` (Optional[WebSocket]): WebSocket for real-time communication

**Returns:**

- `Union[WorkflowRunOutput, AsyncIterator[WorkflowRunOutputEvent]]`: Either a WorkflowRunOutput or an iterator of WorkflowRunOutputEvents, depending on the `stream` parameter

### `print_response`

Print workflow execution with rich formatting and optional streaming.

**Parameters:**

- `input` (Union[str, Dict[str, Any], List[Any], BaseModel, List[Message]]): The input to send to the workflow
- `additional_data` (Optional[Dict[str, Any]]): Additional data to include with the input
- `user_id` (Optional[str]): User ID to use
- `session_id` (Optional[str]): Session ID to use
- `audio` (Optional[List[Audio]]): Audio files to include
- `images` (Optional[List[Image]]): Image files to include
- `videos` (Optional[List[Video]]): Video files to include
- `files` (Optional[List[File]]): Files to include
- `stream` (Optional[bool]): Whether to stream the response content
- `markdown` (bool): Whether to render content as markdown
- `show_time` (bool): Whether to show execution time
- `show_step_details` (bool): Whether to show individual step outputs
- `console` (Optional[Any]): Rich console instance (optional)

### `aprint_response`

Print workflow execution with rich formatting and optional streaming asynchronously.

**Parameters:**

- `input` (Union[str, Dict[str, Any], List[Any], BaseModel, List[Message]]): The input to send to the workflow
- `additional_data` (Optional[Dict[str, Any]]): Additional data to include with the input
- `user_id` (Optional[str]): User ID to use
- `session_id` (Optional[str]): Session ID to use
- `audio` (Optional[List[Audio]]): Audio files to include
- `images` (Optional[List[Image]]): Image files to include
- `videos` (Optional[List[Video]]): Video files to include
- `files` (Optional[List[File]]): Files to include
- `stream` (Optional[bool]): Whether to stream the response content
- `markdown` (bool): Whether to render content as markdown
- `show_time` (bool): Whether to show execution time
- `show_step_details` (bool): Whether to show individual step outputs
- `console` (Optional[Any]): Rich console instance (optional)

### `cli_app`

Run an interactive command-line interface to interact with the workflow.

**Parameters:**

- `input` (Optional[str]): The input to send to the workflow
- `session_id` (Optional[str]): Session ID to use
- `user_id` (Optional[str]): User ID to use
- `user` (str): Name for the user (default: "User")
- `emoji` (str): Emoji for the user (default: ":technologist:")
- `stream` (Optional[bool]): Whether to stream the response content
- `markdown` (bool): Whether to render content as markdown (default: True)
- `show_time` (bool): Whether to show execution time (default: True)
- `show_step_details` (bool): Whether to show individual step outputs (default: True)
- `exit_on` (Optional[List[str]]): List of commands to exit the CLI
- `**kwargs`: Additional keyword arguments

### `acli_app`

Run an interactive command-line interface to interact with the workflow asynchronously.

**Parameters:**

- `input` (Optional[str]): The input to send to the workflow
- `session_id` (Optional[str]): Session ID to use
- `user_id` (Optional[str]): User ID to use
- `user` (str): Name for the user (default: "User")
- `emoji` (str): Emoji for the user (default: ":technologist:")
- `stream` (Optional[bool]): Whether to stream the response content
- `markdown` (bool): Whether to render content as markdown (default: True)
- `show_time` (bool): Whether to show execution time (default: True)
- `show_step_details` (bool): Whether to show individual step outputs (default: True)
- `exit_on` (Optional[List[str]]): List of commands to exit the CLI
- `**kwargs`: Additional keyword arguments

### `cancel_run`

Cancel a running workflow execution.

**Parameters:**

- `run_id` (str): The run_id to cancel

**Returns:**

- `bool`: True if the run was found and marked for cancellation, False otherwise

### `get_run`

Get the status and details of a background workflow run.

**Parameters:**

- `run_id` (str): The run ID to get

**Returns:**

- `Optional[WorkflowRunOutput]`: The workflow run output if found

### `get_run_output`

Get a WorkflowRunOutput from the database.

**Parameters:**

- `run_id` (str): The run ID
- `session_id` (Optional[str]): Session ID to use

**Returns:**

- `Optional[WorkflowRunOutput]`: The run output

### `get_last_run_output`

Get the last run response from the database for the given session ID.

**Parameters:**

- `session_id` (Optional[str]): Session ID to use

**Returns:**

- `Optional[WorkflowRunOutput]`: The last run output

### `get_chat_history`

Return a list of dictionaries containing the input and output for each run in the session.

**Parameters:**

- `session_id` (Optional[str]): The session ID to get the chat history for. If not provided, the current cached session ID is used
- `last_n_runs` (Optional[int]): Number of recent runs to include. If None, all runs will be considered

**Returns:**

- `List[WorkflowChatInteraction]`: A list of dictionaries containing the input and output for each run

### `get_session`

Get the session for the given session ID.

**Parameters:**

- `session_id` (Optional[str]): Session ID to use

**Returns:**

- `Optional[WorkflowSession]`: The workflow session

### `get_session_state`

Get the session state for the given session ID.

**Parameters:**

- `session_id` (Optional[str]): Session ID to use

**Returns:**

- `Dict[str, Any]`: The session state

### `get_session_name`

Get the session name for the given session ID.

**Parameters:**

- `session_id` (Optional[str]): Session ID to use

**Returns:**

- `str`: The session name

### `set_session_name`

Set the session name and save to storage.

**Parameters:**

- `session_id` (Optional[str]): Session ID to use
- `autogenerate` (bool): Whether to autogenerate the name
- `session_name` (Optional[str]): The name to set

**Returns:**

- `WorkflowSession`: The updated session

### `get_session_metrics`

Get the session metrics for the given session ID.

**Parameters:**

- `session_id` (Optional[str]): Session ID to use

**Returns:**

- `Optional[Metrics]`: The session metrics

### `delete_session`

Delete a session.

**Parameters:**

- `session_id` (str): Session ID to delete

### `save_session`

Save the WorkflowSession to storage.

**Parameters:**

- `session` (WorkflowSession): The session to save

### `to_dict`

Convert workflow to dictionary representation.

**Returns:**

- `Dict[str, Any]`: Dictionary representation of the workflow
