---
title: Slack
description: å°†æ™ºèƒ½ä½“ä½œä¸º Slack åº”ç”¨ç¨‹åºæ‰˜ç®¡
---

ä½¿ç”¨ Slack æ¥å£åœ¨ Slack ä¸Šæä¾›æ™ºèƒ½ä½“ã€å›¢é˜Ÿæˆ–å·¥ä½œæµæœåŠ¡ã€‚å®ƒåœ¨ FastAPI åº”ç”¨ä¸ŠæŒ‚è½½ Slack äº‹ä»¶è·¯ç”±ï¼Œå¹¶å°†å“åº”å‘é€å› Slack çº¿ç¨‹ã€‚

## è®¾ç½®æ­¥éª¤

è¯·æŒ‰ç…§ [cookbook](https://github.com/agno-agi/agno/blob/main/cookbook/06_agent_os/interfaces/slack/README.md) ä¸­çš„ Slack è®¾ç½®æŒ‡å—è¿›è¡Œæ“ä½œã€‚

å¿…éœ€é…ç½®ï¼š

- `SLACK_TOKEN`ï¼ˆBot User OAuth Tokenï¼‰
- `SLACK_SIGNING_SECRET`ï¼ˆApp Signing Secretï¼‰
- ä¸€ä¸ª ngrok éš§é“ï¼ˆç”¨äºæœ¬åœ°å¼€å‘ï¼‰å’ŒæŒ‡å‘ `/slack/events` çš„äº‹ä»¶è®¢é˜…

## ç¤ºä¾‹ç”¨æ³•

åˆ›å»ºä¸€ä¸ªæ™ºèƒ½ä½“ï¼Œä½¿ç”¨ `Slack` æ¥å£æš´éœ²å®ƒï¼Œå¹¶é€šè¿‡ `AgentOS` æä¾›æœåŠ¡ï¼š

```python basic.py
from agno.agent import Agent
from agno.models.openai import OpenAIChat
from agno.os import AgentOS
from agno.os.interfaces.slack import Slack

# åˆ›å»ºåŸºç¡€æ™ºèƒ½ä½“
basic_agent = Agent(
    name="åŸºç¡€æ™ºèƒ½ä½“",
    model=OpenAIChat(id="gpt-5-mini"), # ç¡®ä¿è®¾ç½®äº† OPENAI_API_KEY
    add_history_to_context=True,
    num_history_runs=3,
    add_datetime_to_context=True,
    instructions="""
    ä½ æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„ Slack æ™ºèƒ½åŠ©æ‰‹ã€‚
    è¯·ç”¨ç®€æ´ã€å‹å¥½çš„ä¸­æ–‡å›ç­”ç”¨æˆ·é—®é¢˜ã€‚
    å¯ä»¥å¸®åŠ©ç”¨æˆ·å¤„ç†æ—¥å¸¸ä»»åŠ¡ã€å›ç­”é—®é¢˜å’Œæä¾›å»ºè®®ã€‚
    """
)

# åˆ›å»ºå¸¦æœ‰ Slack æ¥å£çš„ AgentOS å®ä¾‹
agent_os = AgentOS(
    agents=[basic_agent],
    interfaces=[Slack(agent=basic_agent)],
)
app = agent_os.get_app()

# å¯åŠ¨æœåŠ¡
if __name__ == "__main__":
    agent_os.serve(app="basic:app", port=8000, reload=True)
```

å®Œæ•´ç¤ºä¾‹å¯åœ¨ `cookbook/06_agent_os/interfaces/slack/basic.py` ä¸­æ‰¾åˆ°ã€‚

## æ ¸å¿ƒç»„ä»¶

- `Slack`ï¼ˆæ¥å£ï¼‰ï¼šé€šè¿‡ FastAPI å°† Agno `Agent`ã€`Team` æˆ– `Workflow` åŒ…è£…ä»¥è¿›è¡Œ Slack é›†æˆã€‚

## Slack æ¥å£æ¶æ„

### äº‹ä»¶å¤„ç†æµç¨‹

```mermaid
graph TB
    A[Slack äº‹ä»¶] --> B[äº‹ä»¶éªŒè¯]
    B --> C[äº‹ä»¶è§£æ]
    C --> D[æ™ºèƒ½ä½“å¤„ç†]
    D --> E[å“åº”æ ¼å¼åŒ–]
    E --> F[Slack API è°ƒç”¨]
    F --> G[ç”¨æˆ·æ”¶åˆ°å“åº”]
    
    subgraph "AgentOS Slack æ¥å£"
        B1[ç­¾åéªŒè¯] --> B2[äº‹ä»¶ç±»å‹è¯†åˆ«]
        B2 --> B3[æ¶ˆæ¯æå–]
        B3 --> B4[ä¸Šä¸‹æ–‡æ„å»º]
    end
    
    subgraph "æ™ºèƒ½ä½“å¤„ç†"
        D1[æ¶ˆæ¯é¢„å¤„ç†] --> D2[æ™ºèƒ½ä½“æ¨ç†]
        D2 --> D3[å·¥å…·è°ƒç”¨]
        D3 --> D4[å“åº”ç”Ÿæˆ]
    end
```

## é«˜çº§é…ç½®

### 1. è‡ªå®šä¹‰ Slack é…ç½®

```python
from agno.os.interfaces.slack import Slack, SlackConfig

# è‡ªå®šä¹‰ Slack é…ç½®
slack_config = SlackConfig(
    endpoint="/slack/events",
    bot_token_env="SLACK_BOT_TOKEN",
    signing_secret_env="SLACK_SIGNING_SECRET",
    interactive_components=True,
    slash_commands=["help", "status", "reset", "analyze"],
    buttons=True,
    modals=True,
    app_home=True,
    message_actions=True,
    reaction_added=True,
    team_join=True,
    pin_added=True
)

# åˆ›å»ºè‡ªå®šä¹‰ Slack æ¥å£
slack_interface = Slack(
    agent=basic_agent,
    config=slack_config
)
```

### 2. å¤šæ™ºèƒ½ä½“ Slack é›†æˆ

```python
from agno.agent import Agent
from agno.team import Team
from agno.os.interfaces.slack import Slack

# åˆ›å»ºä¸“é—¨çš„æ™ºèƒ½ä½“
tech_support_agent = Agent(
    name="æŠ€æœ¯æ”¯æŒ",
    instructions="ä½ æ˜¯æŠ€æœ¯æ”¯æŒä¸“å®¶ï¼Œä¸“é—¨è§£å†³æŠ€æœ¯é—®é¢˜"
)

hr_agent = Agent(
    name="äººåŠ›èµ„æº",
    instructions="ä½ æ˜¯äººåŠ›èµ„æºä¸“å®¶ï¼Œå¤„ç† HR ç›¸å…³é—®é¢˜"
)

finance_agent = Agent(
    name="è´¢åŠ¡åŠ©æ‰‹",
    instructions="ä½ æ˜¯è´¢åŠ¡ä¸“å®¶ï¼Œæä¾›è´¢åŠ¡å»ºè®®å’Œåˆ†æ"
)

# åˆ›å»ºæ™ºèƒ½ä½“å›¢é˜Ÿ
support_team = Team(
    agents=[tech_support_agent, hr_agent, finance_agent],
    instructions="å›¢é˜Ÿåä½œè§£å†³ç”¨æˆ·é—®é¢˜ï¼Œæ ¹æ®é—®é¢˜ç±»å‹åˆ†é…ç»™åˆé€‚çš„ä¸“å®¶"
)

# ä¸ºæ¯ä¸ªæ™ºèƒ½ä½“åˆ›å»ºä¸“é—¨çš„ Slack æ¥å£
slack_interfaces = [
    Slack(agent=tech_support_agent, channel="#tech-support"),
    Slack(agent=hr_agent, channel="#hr-help"),
    Slack(agent=finance_agent, channel="#finance"),
    Slack(agent=support_team, channel="#general-support")
]

agent_os = AgentOS(
    agents=[tech_support_agent, hr_agent, finance_agent, support_team],
    interfaces=slack_interfaces
)
```

### 3. è‡ªå®šä¹‰äº‹ä»¶å¤„ç†å™¨

```python
from agno.os.interfaces.slack import SlackEventHandler

class CustomSlackEventHandler(SlackEventHandler):
    async def handle_message(self, event_data):
        """å¤„ç†æ¶ˆæ¯äº‹ä»¶"""
        # è‡ªå®šä¹‰æ¶ˆæ¯å¤„ç†é€»è¾‘
        message = event_data.get("text", "")
        user_id = event_data.get("user")
        channel_id = event_data.get("channel")
        
        # æ£€æŸ¥æ˜¯å¦æ˜¯ç‰¹å®šå‘½ä»¤
        if message.startswith("!"):
            await self.handle_slash_command(event_data)
        else:
            await super().handle_message(event_data)
    
    async def handle_slash_command(self, event_data):
        """å¤„ç†æ–œæ å‘½ä»¤"""
        command = event_data.get("text", "").split()[0].lower()
        
        if command == "!help":
            await self.send_help_message(event_data)
        elif command == "!status":
            await self.send_status_update(event_data)
        elif command == "!analyze":
            await self.analyze_conversation(event_data)
    
    async def send_help_message(self, event_data):
        """å‘é€å¸®åŠ©æ¶ˆæ¯"""
        help_text = """
        ğŸ¤– *æ™ºèƒ½åŠ©æ‰‹å‘½ä»¤åˆ—è¡¨ï¼š*
        
        `!help` - æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯
        `!status` - æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€
        `!analyze` - åˆ†æå½“å‰å¯¹è¯
        `!reset` - é‡ç½®å¯¹è¯ä¸Šä¸‹æ–‡
        
        ç›´æ¥å‘é€æ¶ˆæ¯å³å¯ä¸æ™ºèƒ½åŠ©æ‰‹å¯¹è¯ï¼
        """
        
        await self.slack_client.chat_postMessage(
            channel=event_data.get("channel"),
            text=help_text,
            thread_ts=event_data.get("thread_ts")
        )
    
    async def send_status_update(self, event_data):
        """å‘é€çŠ¶æ€æ›´æ–°"""
        import psutil
        import datetime
        
        # è·å–ç³»ç»Ÿä¿¡æ¯
        cpu_percent = psutil.cpu_percent()
        memory = psutil.virtual_memory()
        disk = psutil.disk_usage('/')
        
        status_text = f"""
        ğŸ“Š *ç³»ç»ŸçŠ¶æ€æŠ¥å‘Š*
        
        ğŸ”§ **CPU ä½¿ç”¨ç‡**: {cpu_percent}%
        ğŸ’¾ **å†…å­˜ä½¿ç”¨**: {memory.percent}% ({memory.used//1024//1024}MB/{memory.total//1024//1024}MB)
        ğŸ’¿ **ç£ç›˜ä½¿ç”¨**: {disk.percent}% ({disk.used//1024//1024//1024}GB/{disk.total//1024//1024//1024}GB)
        â° **æ›´æ–°æ—¶é—´**: {datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S')}
        """
        
        await self.slack_client.chat_postMessage(
            channel=event_data.get("channel"),
            text=status_text,
            thread_ts=event_data.get("thread_ts")
        )

# åº”ç”¨è‡ªå®šä¹‰äº‹ä»¶å¤„ç†å™¨
slack_interface = Slack(
    agent=basic_agent,
    event_handler=CustomSlackEventHandler()
)
```

## äº¤äº’å¼ç»„ä»¶

### 1. æŒ‰é’® and äº¤äº’å¼æ¶ˆæ¯

```python
from agno.os.interfaces.slack import InteractiveComponents

class InteractiveSlackHandler(InteractiveComponents):
    async def send_with_buttons(self, channel, text, buttons):
        """å‘é€å¸¦æŒ‰é’®çš„æ¶ˆæ¯"""
        blocks = [
            {
                "type": "section",
                "text": {"type": "mrkdwn", "text": text}
            },
            {
                "type": "actions",
                "elements": buttons
            }
        ]
        
        await self.slack_client.chat_postMessage(
            channel=channel,
            blocks=blocks
        )
    
    async def send_quick_reply_options(self, channel, text, options):
        """å‘é€å¿«é€Ÿå›å¤é€‰é¡¹"""
        blocks = [
            {
                "type": "section",
                "text": {"type": "mrkdwn", "text": text}
            },
            {
                "type": "actions",
                "elements": [
                    {
                        "type": "buttons",
                        "text": {"type": "plain_text", "text": option},
                        "action_id": f"quick_reply_{option.lower().replace(' ', '_')}"
                    }
                    for option in options
                ]
            }
        ]
        
        await self.slack_client.chat_postMessage(
            channel=channel,
            blocks=blocks
        )

# ä½¿ç”¨äº¤äº’å¼ç»„ä»¶
async def send_welcome_message(channel, user_name):
    """å‘é€æ¬¢è¿æ¶ˆæ¯"""
    handler = InteractiveSlackHandler()
    
    welcome_text = f"ğŸ‘‹ æ¬¢è¿ {user_name}ï¼æˆ‘æ˜¯ä½ çš„æ™ºèƒ½åŠ©æ‰‹ã€‚æˆ‘å¯ä»¥å¸®ä½ ï¼š"
    
    buttons = [
        {
            "type": "button",
            "text": {"type": "plain_text", "text": "ğŸ” æœç´¢ä¿¡æ¯"},
            "action_id": "search_info"
        },
        {
            "type": "button", 
            "text": {"type": "plain_text", "text": "ğŸ“Š ç”ŸæˆæŠ¥å‘Š"},
            "action_id": "generate_report"
        },
        {
            "type": "button",
            "text": {"type": "plain_text", "text": "ğŸ’¬ å¼€å§‹å¯¹è¯"},
            "action_id": "start_chat"
        }
    ]
    
    await handler.send_with_buttons(channel, welcome_text, buttons)
```

### 2. æ¨¡æ€æ¡†ï¼ˆModalsï¼‰

```python
from agno.os.interfaces.slack import ModalHandler

class SlackModalHandler(ModalHandler):
    async def open_feedback_modal(self, trigger_id):
        """æ‰“å¼€åé¦ˆæ¨¡æ€æ¡†"""
        modal_view = {
            "type": "modal",
            "title": {"type": "plain_text", "text": "ğŸ’¬ ç”¨æˆ·åé¦ˆ"},
            "submit": {"type": "plain_text", "text": "æäº¤"},
            "close": {"type": "plain_text", "text": "å–æ¶ˆ"},
            "blocks": [
                {
                    "type": "input",
                    "block_id": "feedback_type",
                    "element": {
                        "type": "static_select",
                        "action_id": "type",
                        "placeholder": {"type": "plain_text", "text": "é€‰æ‹©åé¦ˆç±»å‹"},
                        "options": [
                            {"text": {"type": "plain_text", "text": "åŠŸèƒ½å»ºè®®"}, "value": "feature"},
                            {"text": {"type": "plain_text", "text": "é”™è¯¯æŠ¥å‘Š"}, "value": "bug"},
                            {"text": {"type": "plain_text", "text": "ä¸€èˆ¬åé¦ˆ"}, "value": "general"}
                        ]
                    },
                    "label": {"type": "plain_text", "text": "åé¦ˆç±»å‹"}
                },
                {
                    "type": "input",
                    "block_id": "feedback_content",
                    "element": {
                        "type": "plain_text_input",
                        "action_id": "content",
                        "multiline": True,
                        "placeholder": {"type": "plain_text", "text": "è¯·è¯¦ç»†æè¿°æ‚¨çš„åé¦ˆ..."}
                    },
                    "label": {"type": "plain_text", "text": "åé¦ˆå†…å®¹"}
                },
                {
                    "type": "input",
                    "block_id": "contact_info",
                    "element": {
                        "type": "plain_text_input",
                        "action_id": "contact",
                        "placeholder": {"type": "plain_text", "text": "é‚®ç®±æˆ–ç”¨æˆ·åï¼ˆå¯é€‰ï¼‰"}
                    },
                    "label": {"type": "plain_text", "text": "è”ç³»æ–¹å¼"},
                    "optional": True
                }
            ]
        }
        
        await self.slack_client.views_open(
            trigger_id=trigger_id,
            view=modal_view
        )
    
    async def handle_modal_submission(self, payload):
        """å¤„ç†æ¨¡æ€æ¡†æäº¤"""
        feedback_type = payload["view"]["state"]["values"]["feedback_type"]["type"]["selected_option"]["value"]
        feedback_content = payload["view"]["state"]["values"]["feedback_content"]["content"]["value"]
        contact_info = payload["view"]["state"]["values"]["contact_info"]["contact"]["value"]
        
        # å¤„ç†åé¦ˆæ•°æ®
        await self.process_feedback(feedback_type, feedback_content, contact_info)
        
        # å‘é€ç¡®è®¤æ¶ˆæ¯
        await self.slack_client.chat_postMessage(
            channel=payload["user"]["id"],
            text="âœ… æ„Ÿè°¢æ‚¨çš„åé¦ˆï¼æˆ‘ä»¬å·²æ”¶åˆ°å¹¶ä¼šè®¤çœŸå¤„ç†ã€‚"
        )
```

## æ–œæ å‘½ä»¤

### 1. è‡ªå®šä¹‰æ–œæ å‘½ä»¤

```python
from agno.os.interfaces.slack import SlashCommandHandler

class CustomSlashCommands(SlashCommandHandler):
    def __init__(self, slack_client, agent):
        super().__init__(slack_client, agent)
        self.commands = {
            "/help": self.help_command,
            "/status": self.status_command,
            "/analyze": self.analyze_command,
            "/summarize": self.summarize_command,
            "/schedule": self.schedule_command,
            "/poll": self.poll_command
        }
    
    async def help_command(self, command_data):
        """å¸®åŠ©å‘½ä»¤"""
        help_text = """
        ğŸ¤– *å¯ç”¨å‘½ä»¤åˆ—è¡¨ï¼š*
        
        `/help` - æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯
        `/status` - æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€
        `/analyze` - åˆ†æå½“å‰å¯¹è¯
        `/summarize` - æ€»ç»“å¯¹è¯å†…å®¹
        `/schedule [æ—¶é—´] [ä»»åŠ¡]` - å®‰æ’ä»»åŠ¡
        `/poll [é—®é¢˜] [é€‰é¡¹1] [é€‰é¡¹2]` - åˆ›å»ºæŠ•ç¥¨
        
        ğŸ’¡ æç¤ºï¼šç›´æ¥ @æ™ºèƒ½åŠ©æ‰‹ ä¹Ÿå¯ä»¥å¼€å§‹å¯¹è¯ï¼
        """
        
        await self.slack_client.chat_postEphemeral(
            channel=command_data["channel_id"],
            user=command_data["user_id"],
            text=help_text
        )
    
    async def analyze_command(self, command_data):
        """åˆ†æå‘½ä»¤"""
        # è·å–æœ€è¿‘çš„å¯¹è¯å†å²
        history = await self.get_conversation_history(command_data["channel_id"])
        
        # ç”Ÿæˆåˆ†ææŠ¥å‘Š
        analysis = await self.agent.analyze_conversation(history)
        
        analysis_text = f"""
        ğŸ“Š *å¯¹è¯åˆ†ææŠ¥å‘Š*
        
        **ä¸»é¢˜**: {analysis['main_topic']}
        **å‚ä¸äººæ•°**: {analysis['participant_count']}
        **æ¶ˆæ¯æ•°é‡**: {analysis['message_count']}
        **æƒ…æ„Ÿå€¾å‘**: {analysis['sentiment']}
        
        **å…³é”®è¦ç‚¹**:
        {chr(10).join(f"â€¢ {point}" for point in analysis['key_points'])}
        """
        
        await self.slack_client.chat_postMessage(
            channel=command_data["channel_id"],
            text=analysis_text
        )
    
    async def poll_command(self, command_data):
        """æŠ•ç¥¨å‘½ä»¤"""
        text = command_data["text"]
        parts = text.split()
        
        if len(parts) < 3:
            await self.slack_client.chat_postEphemeral(
                channel=command_data["channel_id"],
                user=command_data["user_id"],
                text="âŒ æ ¼å¼é”™è¯¯ï¼ä½¿ç”¨: `/poll [é—®é¢˜] [é€‰é¡¹1] [é€‰é¡¹2] ...`"
            )
            return
        
        question = parts[1]
        options = parts[2:]
        
        # åˆ›å»ºæŠ•ç¥¨æ¶ˆæ¯
        poll_blocks = [
            {
                "type": "section",
                "text": {"type": "mrkdwn", "text": f"ğŸ“Š *æŠ•ç¥¨ï¼š{question}*"}
            }
        ]
        
        # æ·»åŠ é€‰é¡¹æŒ‰é’®
        for i, option in enumerate(options[:5]):  # æœ€å¤š5ä¸ªé€‰é¡¹
            poll_blocks.append({
                "type": "actions",
                "elements": [
                    {
                        "type": "button",
                        "text": {"type": "plain_text", "text": option},
                        "action_id": f"poll_vote_{i}",
                        "value": option
                    }
                ]
            })
        
        message = await self.slack_client.chat_postMessage(
            channel=command_data["channel_id"],
            blocks=poll_blocks
        )
        
        # ä¿å­˜æŠ•ç¥¨ä¿¡æ¯
        await self.save_poll(message["ts"], question, options)

# åº”ç”¨æ–œæ å‘½ä»¤å¤„ç†å™¨
slash_handler = CustomSlashCommands(slack_client, basic_agent)
slack_interface = Slack(
    agent=basic_agent,
    slash_command_handler=slash_handler
)
```

## åº”ç”¨ä¸»é¡µé›†æˆ

### 1. è‡ªå®šä¹‰åº”ç”¨ä¸»é¡µ

```python
from agno.os.interfaces.slack import AppHomeHandler

class CustomAppHome(AppHomeHandler):
    async def render_app_home(self, user_id):
        """æ¸²æŸ“åº”ç”¨ä¸»é¡µ"""
        user_info = await self.get_user_info(user_id)
        recent_conversations = await self.get_recent_conversations(user_id)
        
        home_view = {
            "type": "home",
            "blocks": [
                {
                    "type": "header",
                    "text": {"type": "plain_text", "text": "ğŸ¤– æ™ºèƒ½åŠ©æ‰‹æ§åˆ¶å°"}
                },
                {
                    "type": "section",
                    "text": {
                        "type": "mrkdwn",
                        "text": f"æ¬¢è¿å›æ¥ï¼Œ{user_info['real_name']}ï¼\n\nä»Šå¤©æ˜¯ä¸ªç¾å¥½çš„ä¸€å¤©ï¼Œè®©æˆ‘æ¥å¸®åŠ©ä½ å¤„ç†ä»»åŠ¡ã€‚"
                    }
                },
                {
                    "type": "divider"
                },
                {
                    "type": "section",
                    "text": {"type": "mrkdwn", "text": "ğŸ“‹ *å¿«é€Ÿæ“ä½œ*"}
                },
                {
                    "type": "actions",
                    "elements": [
                        {
                            "type": "button",
                            "text": {"type": "plain_text", "text": "ğŸ’¬ å¼€å§‹æ–°å¯¹è¯"},
                            "action_id": "start_new_conversation"
                        },
                        {
                            "type": "button",
                            "text": {"type": "plain_text", "text": "ğŸ“Š æŸ¥çœ‹ç»Ÿè®¡"},
                            "action_id": "view_statistics"
                        }
                    ]
                },
                {
                    "type": "divider"
                },
                {
                    "type": "section",
                    "text": {"type": "mrkdwn", "text": "ğŸ“ *æœ€è¿‘å¯¹è¯*"}
                }
            ]
        }
        
        # æ·»åŠ æœ€è¿‘å¯¹è¯
        for conv in recent_conversations[:5]:
            home_view["blocks"].append({
                "type": "section",
                "text": {
                    "type": "mrkdwn",
                    "text": f"â€¢ {conv['channel']} - {conv['last_message'][:50]}..."
                },
                "accessory": {
                    "type": "button",
                    "text": {"type": "plain_text", "text": "æŸ¥çœ‹"},
                    "action_id": "open_conversation",
                    "value": conv['channel']
                }
            })
        
        await self.slack_client.views_publish(
            user_id=user_id,
            view=home_view
        )

# åº”ç”¨è‡ªå®šä¹‰ä¸»é¡µ
app_home_handler = CustomAppHomeHandler()
slack_interface = Slack(
    agent=basic_agent,
    app_home_handler=app_home_handler
)
```

## æ–‡ä»¶å’Œåª’ä½“å¤„ç†

### 1. æ–‡ä»¶ä¸Šä¼ å¤„ç†

```python
from agno.os.interfaces.slack import FileHandler

class SlackFileHandler(FileHandler):
    async def handle_file_share(self, event_data):
        """å¤„ç†æ–‡ä»¶åˆ†äº«äº‹ä»¶"""
        file_id = event_data.get("file_id")
        user_id = event_data.get("user_id")
        channel_id = event_data.get("channel_id")
        
        # è·å–æ–‡ä»¶ä¿¡æ¯
        file_info = await self.slack_client.files_info(file=file_id)
        file_url = file_info["file"]["url_private"]
        file_name = file_info["file"]["name"]
        file_type = file_info["file"]["mimetype"]
        
        # ä¸‹è½½æ–‡ä»¶å†…å®¹
        if file_type.startswith("text/"):
            content = await self.download_text_file(file_url)
            analysis = await self.analyze_text_content(content)
        elif file_type.startswith("image/"):
            image_data = await self.download_image_file(file_url)
            analysis = await self.analyze_image_content(image_data)
        else:
            analysis = "æŠ±æ­‰ï¼Œæˆ‘æš‚æ—¶æ— æ³•å¤„ç†è¿™ç§ç±»å‹çš„æ–‡ä»¶ã€‚"
        
        # å‘é€åˆ†æç»“æœ
        response = f"""
        ğŸ“ *æ–‡ä»¶åˆ†æç»“æœ*
        
        **æ–‡ä»¶å**: {file_name}
        **æ–‡ä»¶ç±»å‹**: {file_type}
        **åˆ†æç»“æœ**: {analysis}
        """
        
        await self.slack_client.chat_postMessage(
            channel=channel_id,
            text=response,
            thread_ts=event_data.get("thread_ts")
        )
    
    async def analyze_text_content(self, content):
        """åˆ†ææ–‡æœ¬å†…å®¹"""
        # ä½¿ç”¨æ™ºèƒ½ä½“åˆ†ææ–‡æœ¬
        analysis_prompt = f"""
        è¯·åˆ†æä»¥ä¸‹æ–‡æœ¬å†…å®¹ï¼Œæä¾›ï¼š
        1. ä¸»è¦å†…å®¹æ‘˜è¦
        2. å…³é”®è¦ç‚¹
        3. å¯èƒ½çš„è¡ŒåŠ¨å»ºè®®
        
        æ–‡æœ¬å†…å®¹ï¼š
        {content[:2000]}  # é™åˆ¶é•¿åº¦
        """
        
        response = await self.agent.run(analysis_prompt)
        return response.content
    
    async def analyze_image_content(self, image_data):
        """åˆ†æå›¾åƒå†…å®¹"""
        # ä½¿ç”¨å¤šæ¨¡æ€æ™ºèƒ½ä½“åˆ†æå›¾åƒ
        analysis_prompt = """
        è¯·æè¿°è¿™å¼ å›¾ç‰‡çš„å†…å®¹ï¼ŒåŒ…æ‹¬ï¼š
        1. å›¾ç‰‡ä¸­çš„ä¸»è¦å¯¹è±¡
        2. åœºæ™¯æè¿°
        3. å¯èƒ½çš„ç”¨é€”æˆ–æ„ä¹‰
        """
        
        response = await self.agent.run(analysis_prompt, images=[image_data])
        return response.content

# åº”ç”¨æ–‡ä»¶å¤„ç†å™¨
file_handler = SlackFileHandler()
slack_interface = Slack(
    agent=basic_agent,
    file_handler=file_handler
)
```

## ç›‘æ§å’Œåˆ†æ

### 1. ä½¿ç”¨ç»Ÿè®¡

```python
from agno.os.interfaces.slack import SlackAnalytics

class SlackUsageAnalytics(SlackAnalytics):
    def __init__(self):
        self.usage_stats = {
            "daily_messages": {},
            "user_activity": {},
            "command_usage": {},
            "response_times": [],
            "error_count": 0
        }
    
    async def track_message(self, user_id, channel_id, response_time):
        """è·Ÿè¸ªæ¶ˆæ¯ç»Ÿè®¡"""
        today = datetime.now().strftime("%Y-%m-%d")
        
        # æ¯æ—¥æ¶ˆæ¯ç»Ÿè®¡
        if today not in self.usage_stats["daily_messages"]:
            self.usage_stats["daily_messages"][today] = 0
        self.usage_stats["daily_messages"][today] += 1
        
        # ç”¨æˆ·æ´»åŠ¨ç»Ÿè®¡
        if user_id not in self.usage_stats["user_activity"]:
            self.usage_stats["user_activity"][user_id] = 0
        self.usage_stats["user_activity"][user_id] += 1
        
        # å“åº”æ—¶é—´ç»Ÿè®¡
        self.usage_stats["response_times"].append(response_time)
    
    async def track_command_usage(self, command, user_id):
        """è·Ÿè¸ªå‘½ä»¤ä½¿ç”¨"""
        if command not in self.usage_stats["command_usage"]:
            self.usage_stats["command_usage"][command] = 0
        self.usage_stats["command_usage"][command] += 1
    
    def generate_usage_report(self):
        """ç”Ÿæˆä½¿ç”¨æŠ¥å‘Š"""
        avg_response_time = sum(self.usage_stats["response_times"]) / len(self.usage_stats["response_times"]) if self.usage_stats["response_times"] else 0
        
        report = {
            "period": "last_30_days",
            "total_messages": sum(self.usage_stats["daily_messages"].values()),
            "active_users": len(self.usage_stats["user_activity"]),
            "avg_response_time": avg_response_time,
            "error_count": self.usage_stats["error_count"],
            "top_commands": sorted(
                self.usage_stats["command_usage"].items(),
                key=lambda x: x[1],
                reverse=True
            )[:10]
        }
        
        return report

# åº”ç”¨åˆ†æ
analytics = SlackUsageAnalytics()
slack_interface = Slack(
    agent=basic_agent,
    analytics=analytics
)
```

## éƒ¨ç½²å’Œæ‰©å±•

### 1. ç”Ÿäº§ç¯å¢ƒé…ç½®

```yaml
# docker-compose.yml
version: '3.8'

services:
  slack-agent:
    build: .
    ports:
      - "8000:8000"
    environment:
      - SLACK_BOT_TOKEN=${SLACK_BOT_TOKEN}
      - SLACK_SIGNING_SECRET=${SLACK_SIGNING_SECRET}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - REDIS_URL=redis://redis:6379
      - DATABASE_URL=postgresql://user:password@postgres:5432/slack_agent
    depends_on:
      - redis
      - postgres
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
  
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    restart: unless-stopped
  
  postgres:
    image: postgres:15-alpine
    ports:
      - "5432:5432"
    environment:
      - POSTGRES_DB=slack_agent
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=password
    volumes:
      - postgres_data:/var/lib/postgresql/data
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
```

### 2. Kubernetes éƒ¨ç½²

```yaml
# k8s-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: slack-agent
spec:
  replicas: 3
  selector:
    matchLabels:
      app: slack-agent
  template:
    metadata:
      labels:
        app: slack-agent
    spec:
      containers:
      - name: slack-agent
        image: slack-agent:latest
        ports:
        - containerPort: 8000
        env:
        - name: SLACK_BOT_TOKEN
          valueFrom:
            secretKeyRef:
              name: slack-secrets
              key: bot-token
        - name: SLACK_SIGNING_SECRET
          valueFrom:
            secretKeyRef:
              name: slack-secrets
              key: signing-secret
        - name: OPENAI_API_KEY
          valueFrom:
            secretKeyRef:
              name: api-secrets
              key: openai-key
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /health
            port: 8000
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /ready
            port: 8000
          initialDelaySeconds: 5
          periodSeconds: 5

---
apiVersion: v1
kind: Service
metadata:
  name: slack-agent-service
spec:
  selector:
    app: slack-agent
  ports:
  - protocol: TCP
    port: 80
    targetPort: 8000
  type: LoadBalancer
```

## æœ€ä½³å®è·µ

### 1. æ€§èƒ½ä¼˜åŒ–

- **å¼‚æ­¥å¤„ç†**: ä½¿ç”¨å¼‚æ­¥æ“ä½œå¤„ç† Slack äº‹ä»¶
- **è¿æ¥æ± **: å¤ç”¨ Slack API å®¢æˆ·ç«¯è¿æ¥
- **ç¼“å­˜ç­–ç•¥**: ç¼“å­˜ç”¨æˆ·ä¿¡æ¯å’Œé¢‘é“ä¿¡æ¯
- **æ‰¹é‡æ“ä½œ**: æ‰¹é‡å¤„ç† API è¯·æ±‚

### 2. ç”¨æˆ·ä½“éªŒ

- **å¿«é€Ÿå“åº”**: ç¡®è®¤æ”¶åˆ°æ¶ˆæ¯åç«‹å³å“åº”
- **æ™ºèƒ½è·¯ç”±**: æ ¹æ®å†…å®¹ç±»å‹è·¯ç”±åˆ°åˆé€‚çš„å¤„ç†å™¨
- **ä¸ªæ€§åŒ–**: è®°ä½ç”¨æˆ·åå¥½å’Œå¯¹è¯å†å²
- **å¤šè¯­è¨€æ”¯æŒ**: æ”¯æŒä¸­è‹±æ–‡æ··åˆå¯¹è¯

### 3. å®‰å…¨è€ƒè™‘

- **è¾“å…¥éªŒè¯**: éªŒè¯æ‰€æœ‰ç”¨æˆ·è¾“å…¥
- **æƒé™æ§åˆ¶**: å®æ–½é€‚å½“çš„æƒé™æ£€æŸ¥
- **æ•°æ®ä¿æŠ¤**: ä¿æŠ¤æ•æ„Ÿç”¨æˆ·æ•°æ®
- **å®¡è®¡æ—¥å¿—**: è®°å½•æ‰€æœ‰é‡è¦æ“ä½œ

### 4. ç›‘æ§å’Œç»´æŠ¤

- **å¥åº·æ£€æŸ¥**: å®æ–½å…¨é¢çš„å¥åº·æ£€æŸ¥
- **é”™è¯¯å¤„ç†**: ä¼˜é›…å¤„ç†æ‰€æœ‰é”™è¯¯æƒ…å†µ
- **æ€§èƒ½ç›‘æ§**: ç›‘æ§å“åº”æ—¶é—´å’Œèµ„æºä½¿ç”¨
- **å‘Šè­¦æœºåˆ¶**: è®¾ç½®æ™ºèƒ½å‘Šè­¦è§„åˆ™

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### äº‹ä»¶éªŒè¯å¤±è´¥

**é—®é¢˜**: Slack äº‹ä»¶ç­¾åéªŒè¯å¤±è´¥
**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ `SLACK_SIGNING_SECRET` é…ç½®
2. éªŒè¯æ—¶é—´æˆ³æ˜¯å¦åœ¨æœ‰æ•ˆèŒƒå›´å†…
3. ç¡®è®¤ç­¾åè®¡ç®—é€»è¾‘æ­£ç¡®

#### æƒé™ä¸è¶³

**é—®é¢˜**: æ™ºèƒ½ä½“æ— æ³•è®¿é—®æŸäº›é¢‘é“æˆ–åŠŸèƒ½
**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ Bot Token æƒé™èŒƒå›´
2. ç¡®è®¤æ™ºèƒ½ä½“å·²æ·»åŠ åˆ°ç›¸å…³é¢‘é“
3. éªŒè¯ç”¨æˆ·æƒé™è®¾ç½®

#### å“åº”è¶…æ—¶

**é—®é¢˜**: Slack è¯·æ±‚è¶…æ—¶
**è§£å†³æ–¹æ¡ˆ**:
1. åœ¨ 3 ç§’å†…å‘é€ç¡®è®¤å“åº”
2. ä½¿ç”¨åå°ä»»åŠ¡å¤„ç†é•¿æ—¶é—´æ“ä½œ
3. å®æ–½é€‚å½“çš„è¶…æ—¶å¤„ç†

### è°ƒè¯•å·¥å…·

```python
# Slack è°ƒè¯•å·¥å…·
import asyncio
from agno.os.interfaces.slack import SlackDebugger

async def debug_slack_interface():
    """è°ƒè¯• Slack æ¥å£"""
    debugger = SlackDebugger()
    
    # æµ‹è¯• Slack è¿æ¥
    connection_test = await debugger.test_slack_connection()
    print(f"Slack è¿æ¥æµ‹è¯•: {connection_test}")
    
    # éªŒè¯é…ç½®
    config_validation = await debugger.validate_slack_config()
    print(f"é…ç½®éªŒè¯: {config_validation}")
    
    # æ£€æŸ¥æƒé™
    permissions_check = await debugger.check_bot_permissions()
    print(f"æƒé™æ£€æŸ¥: {permissions_check}")
    
    # æµ‹è¯•äº‹ä»¶å¤„ç†
    event_test = await debugger.test_event_handling()
    print(f"äº‹ä»¶å¤„ç†æµ‹è¯•: {event_test}")

asyncio.run(debug_slack_interface())
```

## ä¸‹ä¸€æ­¥

- æŸ¥çœ‹[WhatsApp æ¥å£](/agent-os/interfaces/whatsapp/introduction)
- äº†è§£[A2A æ¥å£](/agent-os/interfaces/a2a/introduction)
- æ¢ç´¢[AG-UI æ¥å£](/agent-os/interfaces/ag-ui/introduction)
- æŸ¥çœ‹[AgentOS é…ç½®](/agent-os/config)