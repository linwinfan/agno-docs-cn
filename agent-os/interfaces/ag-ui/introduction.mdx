---
title: AG-UI
description: 通过 AG-UI 协议暴露 Agno 智能体
---

AG-UI，即[智能体-用户交互协议](https://github.com/ag-ui-protocol/ag-ui)，标准化了 AI 智能体连接到前端应用程序的方式。

<Note>
**从应用迁移**: 如果要从 `AGUIApp` 迁移，请查看 [v2 迁移指南](/how-to/v2-migration#7-apps-interfaces) 获取完整步骤。
</Note>

## 示例用法

<Steps>
  <Step title="安装后端依赖">

```bash
pip install ag-ui-protocol
```

  </Step>
  <Step title="运行后端">
  使用 `AgentOS` 和 `AGUI` 通过 AG-UI 接口暴露 Agno 智能体。

```python basic.py
from agno.agent.agent import Agent
from agno.models.openai import OpenAIChat
from agno.os import AgentOS
from agno.os.interfaces.agui import AGUI

# 创建聊天智能体
chat_agent = Agent(model=OpenAIChat(id="gpt-4o"))

# 创建带有 AG-UI 接口的 AgentOS 实例
agent_os = AgentOS(
    agents=[chat_agent], 
    interfaces=[AGUI(agent=chat_agent)]
)
app = agent_os.get_app()

# 启动服务
if __name__ == "__main__":
    agent_os.serve(app="basic:app", reload=True)
```

  </Step>
  <Step title="运行前端">

使用 Dojo（`ag-ui` 的前端）作为 AG-UI 智能体的高级、可定制界面。

1. 克隆：`git clone https://github.com/ag-ui-protocol/ag-ui.git`
2. 在 `/ag-ui/typescript-sdk` 中安装依赖：`pnpm install`
3. 在 `/ag-ui/integrations/agno` 中构建 Agno 包：`pnpm run build`
4. 按照存储库中的说明启动 Dojo。

  </Step>
</Steps>

## AG-UI 协议概述

### 什么是 AG-UI？

AG-UI（智能体-用户交互协议）是一个开放的标准化协议，定义了：

- **通信格式**: 智能体与前端应用之间的标准消息格式
- **功能接口**: 通用的智能体功能 API（聊天、工具调用、流式响应等）
- **认证机制**: 安全的身份验证和授权流程
- **事件处理**: 实时事件和状态同步机制

### 核心特性

#### 1. 统一的消息格式

```typescript
// AG-UI 消息格式
interface AGUIMessage {
  id: string;
  type: "user" | "assistant" | "system" | "tool";
  content: string;
  timestamp: string;
  metadata?: {
    model?: string;
    tokens?: number;
    tools?: string[];
    sessionId?: string;
  };
  attachments?: AGUIAttachment[];
}

interface AGUIAttachment {
  type: "image" | "file" | "audio" | "video";
  url: string;
  name: string;
  size?: number;
  mimeType?: string;
}
```

#### 2. 实时流式响应

```python
# 流式响应示例
async def stream_response(agent, message):
    """流式响应处理"""
    async for chunk in agent.astream_run(message):
        yield {
            "type": "chunk",
            "content": chunk.content,
            "metadata": {
                "model": chunk.model,
                "tokens": chunk.tokens_used
            }
        }
```

#### 3. 工具调用支持

```python
# 工具调用示例
from agno.tools import Toolkit

class WebSearchTool(Toolkit):
    def __init__(self):
        super().__init__(name="web_search")
        self.register(self.search_web)
    
    def search_web(self, query: str) -> str:
        """搜索网络内容"""
        # 实现网络搜索逻辑
        return f"搜索结果：{query}"

# 智能体配置工具
agent = Agent(
    model=OpenAIChat(id="gpt-4"),
    tools=[WebSearchTool()],
    instructions="你是一个智能助手，可以使用工具搜索网络信息"
)
```

## 高级配置

### 1. 自定义 AG-UI 配置

```python
from agno.os.interfaces.agui import AGUI, AGUIConfig

# 自定义 AG-UI 配置
agui_config = AGUIConfig(
    endpoint="/ag-ui",
    cors_origins=["http://localhost:3000", "https://app.example.com"],
    max_message_length=10000,
    session_timeout=3600,  # 1 小时
    enable_file_upload=True,
    max_file_size=10485760,  # 10MB
    allowed_file_types=["image/*", "text/*", "application/pdf"],
    streaming=True,
    rate_limiting={
        "requests_per_minute": 100,
        "burst_size": 10
    }
)

# 创建 AG-UI 接口
agui_interface = AGUI(
    agent=chat_agent,
    config=agui_config
)
```

### 2. 多智能体支持

```python
from agno.agent.agent import Agent
from agno.team.team import Team
from agno.os.interfaces.agui import AGUI

# 创建多个智能体
research_agent = Agent(
    name="研究助手",
    model=OpenAIChat(id="gpt-4"),
    instructions="你是一个专业的研究助手，擅长信息收集和分析"
)

coding_agent = Agent(
    name="编程助手", 
    model=OpenAIChat(id="gpt-4"),
    instructions="你是一个编程专家，可以帮助解决各种编程问题"
)

# 创建团队
dev_team = Team(
    agents=[research_agent, coding_agent],
    instructions="团队协作解决用户问题"
)

# 为每个智能体创建 AG-UI 接口
agui_interfaces = [
    AGUI(agent=research_agent, endpoint="/research"),
    AGUI(agent=coding_agent, endpoint="/coding"),
    AGUI(agent=dev_team, endpoint="/team")
]

agent_os = AgentOS(
    agents=[research_agent, coding_agent, dev_team],
    interfaces=agui_interfaces
)
```

### 3. 自定义中间件

```python
from agno.os.interfaces.agui import AGUIMiddleware

class CustomMiddleware(AGUIMiddleware):
    async def process_request(self, request):
        """处理请求前的自定义逻辑"""
        # 添加自定义头部
        request.headers["X-Custom-Header"] = "AG-UI-Agent"
        
        # 记录请求日志
        await self.log_request(request)
        
        return request
    
    async def process_response(self, response):
        """处理响应前的自定义逻辑"""
        # 添加自定义响应头
        response.headers["X-Response-Time"] = str(time.time())
        
        return response
    
    async def log_request(self, request):
        """记录请求日志"""
        log_data = {
            "timestamp": datetime.now().isoformat(),
            "method": request.method,
            "path": request.url.path,
            "user_agent": request.headers.get("user-agent")
        }
        
        await self.logger.info("AG-UI 请求", **log_data)

# 应用自定义中间件
agui_interface = AGUI(
    agent=chat_agent,
    middleware=[CustomMiddleware()]
)
```

## 前端集成

### 1. React 集成

```typescript
// AG-UI React 组件
import { AGUIProvider, AGUIMessage, AGUIChat } from '@ag-ui/react';

function App() {
  return (
    <AGUIProvider endpoint="http://localhost:8000/ag-ui">
      <div className="app">
        <header>
          <h1>智能助手</h1>
        </header>
        <main>
          <AGUIChat
            placeholder="请输入您的问题..."
            showTimestamps={true}
            enableFileUpload={true}
            onMessageSend={(message) => {
              console.log('发送消息:', message);
            }}
          />
        </main>
      </div>
    </AGUIProvider>
  );
}

export default App;
```

### 2. Vue.js 集成

```vue
<!-- AG-UI Vue 组件 -->
<template>
  <div class="chat-container">
    <agui-chat
      :endpoint="endpoint"
      :config="chatConfig"
      @message-sent="handleMessage"
      @error-occurred="handleError"
    />
  </div>
</template>

<script>
import { AGUIChat } from '@ag-ui/vue';

export default {
  name: 'ChatInterface',
  components: {
    AGUIChat
  },
  data() {
    return {
      endpoint: 'http://localhost:8000/ag-ui',
      chatConfig: {
        placeholder: '请输入您的问题...',
        showTimestamps: true,
        enableFileUpload: true,
        maxMessageLength: 1000
      }
    };
  },
  methods: {
    handleMessage(message) {
      console.log('消息已发送:', message);
    },
    handleError(error) {
      console.error('发生错误:', error);
    }
  }
};
</script>
```

### 3. 原生 JavaScript 集成

```html
<!-- AG-UI 原生 JS 集成 -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能助手</title>
    <script src="https://cdn.jsdelivr.net/npm/@ag-ui/core@latest/dist/ag-ui.min.js"></script>
</head>
<body>
    <div id="chat-container"></div>
    
    <script>
        // 初始化 AG-UI
        const agui = new AGUI({
            endpoint: 'http://localhost:8000/ag-ui',
            container: '#chat-container',
            config: {
                placeholder: '请输入您的问题...',
                theme: 'light',
                enableFileUpload: true
            }
        });
        
        // 监听事件
        agui.on('message:sent', (message) => {
            console.log('消息已发送:', message);
        });
        
        agui.on('message:received', (message) => {
            console.log('收到消息:', message);
        });
        
        agui.on('error', (error) => {
            console.error('发生错误:', error);
        });
    </script>
</body>
</html>
```

## 安全和认证

### 1. JWT 认证

```python
from agno.os.interfaces.agui import AGUI, AuthConfig
import jwt
from datetime import datetime, timedelta

# JWT 认证配置
auth_config = AuthConfig(
    enabled=True,
    secret_key="your-secret-key",
    algorithm="HS256",
    token_expiry=timedelta(hours=24)
)

class AuthManager:
    def __init__(self, secret_key):
        self.secret_key = secret_key
    
    def generate_token(self, user_id: str, permissions: list) -> str:
        """生成 JWT 令牌"""
        payload = {
            'user_id': user_id,
            'permissions': permissions,
            'exp': datetime.utcnow() + timedelta(hours=24),
            'iat': datetime.utcnow()
        }
        return jwt.encode(payload, self.secret_key, algorithm='HS256')
    
    def verify_token(self, token: str) -> dict:
        """验证 JWT 令牌"""
        try:
            payload = jwt.decode(token, self.secret_key, algorithms=['HS256'])
            return payload
        except jwt.ExpiredSignatureError:
            raise ValueError("令牌已过期")
        except jwt.InvalidTokenError:
            raise ValueError("无效令牌")

# 应用认证配置
agui_interface = AGUI(
    agent=chat_agent,
    auth_config=auth_config,
    auth_manager=AuthManager("your-secret-key")
)
```

### 2. OAuth 集成

```python
from agno.os.interfaces.agui import OAuthProvider

class GitHubOAuthProvider(OAuthProvider):
    def __init__(self, client_id, client_secret):
        super().__init__()
        self.client_id = client_id
        self.client_secret = client_secret
        self.auth_url = "https://github.com/login/oauth/authorize"
        self.token_url = "https://github.com/login/oauth/access_token"
    
    async def get_auth_url(self, redirect_uri: str, state: str) -> str:
        """获取认证 URL"""
        params = {
            'client_id': self.client_id,
            'redirect_uri': redirect_uri,
            'state': state,
            'scope': 'user:email'
        }
        return f"{self.auth_url}?{urlencode(params)}"
    
    async def exchange_code_for_token(self, code: str) -> dict:
        """交换代码获取令牌"""
        data = {
            'client_id': self.client_id,
            'client_secret': self.client_secret,
            'code': code
        }
        
        async with httpx.AsyncClient() as client:
            response = await client.post(self.token_url, data=data)
            return response.json()

# 配置 OAuth
oauth_config = {
    "github": GitHubOAuthProvider(
        client_id="your-github-client-id",
        client_secret="your-github-client-secret"
    )
}

agui_interface = AGUI(
    agent=chat_agent,
    oauth_providers=oauth_config
)
```

## 监控和分析

### 1. 性能监控

```python
from agno.os.interfaces.agui import MetricsCollector

class AGUIMetricsCollector(MetricsCollector):
    def __init__(self):
        self.metrics = {
            'request_count': 0,
            'response_time': [],
            'error_count': 0,
            'active_sessions': 0
        }
    
    async def record_request(self, request):
        """记录请求指标"""
        self.metrics['request_count'] += 1
        self.metrics['active_sessions'] += 1
    
    async def record_response(self, response, response_time):
        """记录响应指标"""
        self.metrics['response_time'].append(response_time)
        self.metrics['active_sessions'] -= 1
    
    async def record_error(self, error):
        """记录错误指标"""
        self.metrics['error_count'] += 1
    
    def get_metrics_summary(self):
        """获取指标摘要"""
        avg_response_time = sum(self.metrics['response_time']) / len(self.metrics['response_time']) if self.metrics['response_time'] else 0
        
        return {
            'total_requests': self.metrics['request_count'],
            'average_response_time': avg_response_time,
            'error_rate': self.metrics['error_count'] / self.metrics['request_count'] if self.metrics['request_count'] > 0 else 0,
            'active_sessions': self.metrics['active_sessions']
        }

# 应用监控
metrics_collector = AGUIMetricsCollector()

agui_interface = AGUI(
    agent=chat_agent,
    metrics_collector=metrics_collector
)
```

### 2. 日志记录

```python
import logging
from agno.os.interfaces.agui import AGUILogger

# 配置日志
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('agui.log'),
        logging.StreamHandler()
    ]
)

logger = logging.getLogger('agui')

class CustomAGUILogger(AGUILogger):
    async def log_message(self, message_type, content, metadata=None):
        """记录消息日志"""
        log_data = {
            'type': message_type,
            'content': content[:100] + '...' if len(content) > 100 else content,
            'metadata': metadata or {}
        }
        
        if message_type == 'error':
            logger.error(f"AG-UI 错误: {log_data}")
        elif message_type == 'warning':
            logger.warning(f"AG-UI 警告: {log_data}")
        else:
            logger.info(f"AG-UI 信息: {log_data}")

# 应用自定义日志记录器
agui_interface = AGUI(
    agent=chat_agent,
    logger=CustomAGUILogger()
)
```

## 部署和扩展

### 1. Docker 部署

```dockerfile
# Dockerfile
FROM python:3.11-slim

WORKDIR /app

# 安装依赖
COPY requirements.txt .
RUN pip install -r requirements.txt

# 复制应用代码
COPY . .

# 暴露端口
EXPOSE 8000

# 启动命令
CMD ["python", "main.py"]
```

```yaml
# docker-compose.yml
version: '3.8'

services:
  agui-backend:
    build: .
    ports:
      - "8000:8000"
    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - AGUI_SECRET_KEY=${AGUI_SECRET_KEY}
    volumes:
      - ./logs:/app/logs
    depends_on:
      - redis
  
  agui-frontend:
    image: node:18-alpine
    working_dir: /app
    ports:
      - "3000:3000"
    volumes:
      - ./frontend:/app
    command: sh -c "npm install && npm start"
  
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data

volumes:
  redis_data:
```

### 2. Kubernetes 部署

```yaml
# k8s-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: agui-backend
spec:
  replicas: 3
  selector:
    matchLabels:
      app: agui-backend
  template:
    metadata:
      labels:
        app: agui-backend
    spec:
      containers:
      - name: agui-backend
        image: agui-backend:latest
        ports:
        - containerPort: 8000
        env:
        - name: OPENAI_API_KEY
          valueFrom:
            secretKeyRef:
              name: agui-secrets
              key: openai-api-key
        - name: REDIS_URL
          value: "redis://redis-service:6379"
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /health
            port: 8000
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /ready
            port: 8000
          initialDelaySeconds: 5
          periodSeconds: 5

---
apiVersion: v1
kind: Service
metadata:
  name: agui-backend-service
spec:
  selector:
    app: agui-backend
  ports:
  - protocol: TCP
    port: 80
    targetPort: 8000
  type: LoadBalancer
```

## 最佳实践

### 1. 性能优化

- **异步处理**: 使用异步操作提高并发性
- **连接池**: 复用数据库和外部服务连接
- **缓存策略**: 实施智能缓存减少重复计算
- **压缩传输**: 启用 gzip 压缩减少传输数据量

### 2. 安全实践

- **HTTPS**: 强制使用 HTTPS 加密传输
- **输入验证**: 严格验证所有用户输入
- **速率限制**: 实施请求速率限制防止滥用
- **日志审计**: 记录所有重要操作用于审计

### 3. 可扩展性设计

- **微服务架构**: 将不同功能分离为独立服务
- **负载均衡**: 使用负载均衡器分发请求
- **水平扩展**: 支持多实例部署和自动扩展
- **数据库分片**: 支持数据库水平分片

### 4. 监控和告警

- **健康检查**: 实施全面的健康检查机制
- **指标收集**: 收集详细的性能和使用指标
- **告警机制**: 设置智能告警规则
- **日志聚合**: 集中管理和分析日志数据

## 故障排除

### 常见问题

#### 连接失败

**问题**: 前端无法连接到后端
**解决方案**:
1. 检查后端服务是否正常运行
2. 验证 CORS 配置是否正确
3. 确认网络连接和防火墙设置
4. 检查端点 URL 配置

#### 认证失败

**问题**: JWT 令牌验证失败
**解决方案**:
1. 检查密钥配置是否正确
2. 验证令牌格式和有效期
3. 确认时钟同步
4. 检查权限配置

#### 性能问题

**问题**: 响应时间过长
**解决方案**:
1. 启用响应缓存
2. 优化数据库查询
3. 增加服务器资源
4. 实施异步处理

### 调试工具

```python
# AG-UI 调试工具
import asyncio
from agno.os.interfaces.agui import AGUIDebugger

async def debug_agui_interface():
    """调试 AG-UI 接口"""
    debugger = AGUIDebugger()
    
    # 检查接口状态
    status = await debugger.check_interface_status()
    print(f"接口状态: {status}")
    
    # 测试连接
    connection_test = await debugger.test_connection()
    print(f"连接测试: {connection_test}")
    
    # 验证配置
    config_validation = await debugger.validate_config()
    print(f"配置验证: {config_validation}")
    
    # 性能测试
    performance_test = await debugger.run_performance_test()
    print(f"性能测试: {performance_test}")

asyncio.run(debug_agui_interface())
```

## 下一步

- 查看[Slack 接口](/agent-os/interfaces/slack/introduction)
- 了解[WhatsApp 接口](/agent-os/interfaces/whatsapp/introduction)
- 探索[A2A 接口](/agent-os/interfaces/a2a/introduction)
- 查看[AgentOS 配置](/agent-os/config)