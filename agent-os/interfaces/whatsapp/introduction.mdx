---
title: WhatsApp
description: å°†æ™ºèƒ½ä½“ä½œä¸º WhatsApp åº”ç”¨ç¨‹åºæ‰˜ç®¡
---

ä½¿ç”¨ WhatsApp æ¥å£é€šè¿‡ WhatsApp æä¾›æ™ºèƒ½ä½“æˆ–å›¢é˜ŸæœåŠ¡ã€‚å®ƒåœ¨ FastAPI åº”ç”¨ä¸ŠæŒ‚è½½ webhook è·¯ç”±ï¼Œå¹¶å°†å“åº”å‘é€å› WhatsApp ç”¨æˆ·å’Œçº¿ç¨‹ã€‚

## è®¾ç½®

è¯·æŒ‰ç…§ [WhatsApp Cookbook](https://github.com/agno-agi/agno/blob/main/cookbook/06_agent_os/interfaces/whatsapp/readme.md) ä¸­çš„ WhatsApp è®¾ç½®æŒ‡å—è¿›è¡Œæ“ä½œã€‚

å¿…éœ€çš„ç¯å¢ƒå˜é‡ï¼š

- `WHATSAPP_ACCESS_TOKEN`
- `WHATSAPP_PHONE_NUMBER_ID`
- `WHATSAPP_VERIFY_TOKEN`
- å¯é€‰ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰ï¼š`WHATSAPP_APP_SECRET` å’Œ `APP_ENV=production`

<Note>
ç”¨æˆ·çš„ç”µè¯å·ç ä¼šè‡ªåŠ¨ç”¨ä½œè¿è¡Œçš„ `user_id`ã€‚è¿™ç¡®ä¿ä¼šè¯å’Œå†…å­˜é€‚å½“åœ°é™å®šç»™ç”¨æˆ·ã€‚

ç”µè¯å·ç ä¹Ÿç”¨äº `session_id`ï¼Œå› æ­¤å•ä¸ª WhatsApp å¯¹è¯å¯¹åº”å•ä¸ªä¼šè¯ã€‚åœ¨ç®¡ç†ä¼šè¯å†å²æ—¶åº”è€ƒè™‘è¿™ä¸€ç‚¹ã€‚
</Note>

## ç¤ºä¾‹ç”¨æ³•

åˆ›å»ºä¸€ä¸ªæ™ºèƒ½ä½“ï¼Œä½¿ç”¨ `Whatsapp` æ¥å£æš´éœ²å®ƒï¼Œå¹¶é€šè¿‡ `AgentOS` æä¾›æœåŠ¡ï¼š

```python
from agno.agent import Agent
from agno.models.openai import OpenAIChat
from agno.os import AgentOS
from agno.os.interfaces.whatsapp import Whatsapp
from agno.tools.openai import OpenAITools

# åˆ›å»ºå›¾åƒå¤„ç†æ™ºèƒ½ä½“
image_agent = Agent(
    name="å›¾åƒåŠ©æ‰‹",
    model=OpenAIChat(id="gpt-5-mini"), # ç¡®ä¿è®¾ç½®äº† OPENAI_API_KEY
    tools=[OpenAITools(image_model="gpt-image-1")],
    markdown=True,
    add_history_to_context=True,
    instructions="""
    ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ WhatsApp å›¾åƒå¤„ç†åŠ©æ‰‹ã€‚
    å¯ä»¥å¸®åŠ©ç”¨æˆ·åˆ†æå›¾åƒã€ç”Ÿæˆå›¾åƒæè¿°ã€æä¾›å›¾åƒç›¸å…³çš„å»ºè®®ã€‚
    è¯·ç”¨ç®€æ´ã€å‹å¥½çš„ä¸­æ–‡å›ç­”ç”¨æˆ·é—®é¢˜ã€‚
    æ”¯æŒå¤šç§å›¾åƒæ ¼å¼ï¼ŒåŒ…æ‹¬ JPGã€PNGã€GIF ç­‰ã€‚
    """
)

# åˆ›å»ºå¸¦æœ‰ WhatsApp æ¥å£çš„ AgentOS å®ä¾‹
agent_os = AgentOS(
    agents=[image_agent],
    interfaces=[Whatsapp(agent=image_agent)],
)
app = agent_os.get_app()

# å¯åŠ¨æœåŠ¡
if __name__ == "__main__":
    agent_os.serve(app="basic:app", port=8000, reload=True)
```

## WhatsApp æ¥å£æ¶æ„

### æ¶ˆæ¯å¤„ç†æµç¨‹

```mermaid
graph TB
    A[WhatsApp ç”¨æˆ·] --> B[WhatsApp API]
    B --> C[Webhook éªŒè¯]
    C --> D[æ¶ˆæ¯è§£æ]
    D --> E[æ™ºèƒ½ä½“å¤„ç†]
    E --> F[å“åº”æ ¼å¼åŒ–]
    F --> G[WhatsApp API]
    G --> H[ç”¨æˆ·æ”¶åˆ°å›å¤]
    
    subgraph "AgentOS WhatsApp æ¥å£"
        B1[Webhook éªŒè¯] --> B2[æ¶ˆæ¯ç±»å‹è¯†åˆ«]
        B2 --> B3[å†…å®¹æå–]
        B3 --> B4[ç”¨æˆ·èº«ä»½éªŒè¯]
    end
    
    subgraph "æ™ºèƒ½ä½“å¤„ç†"
        D1[æ¶ˆæ¯é¢„å¤„ç†] --> D2[å¤šåª’ä½“å¤„ç†]
        D2 --> D3[æ™ºèƒ½ä½“æ¨ç†]
        D3 --> D4[å“åº”ç”Ÿæˆ]
    end
```

## é«˜çº§é…ç½®

### 1. è‡ªå®šä¹‰ WhatsApp é…ç½®

```python
from agno.os.interfaces.whatsapp import Whatsapp, WhatsappConfig

# è‡ªå®šä¹‰ WhatsApp é…ç½®
whatsapp_config = WhatsappConfig(
    endpoint="/whatsapp/webhook",
    access_token_env="WHATSAPP_ACCESS_TOKEN",
    phone_number_id_env="WHATSAPP_PHONE_NUMBER_ID",
    verify_token_env="WHATSAPP_VERIFY_TOKEN",
    app_secret_env="WHATSAPP_APP_SECRET",
    app_env="production",
    webhook_verify_token="your_verify_token",
    media_handling=True,
    max_file_size=10485760,  # 10MB
    supported_mime_types=[
        "image/jpeg", "image/png", "image/gif", "image/webp",
        "audio/mpeg", "audio/wav", "audio/ogg",
        "video/mp4", "video/webm",
        "text/plain", "application/pdf"
    ],
    interactive_messages=True,
    template_messages=True,
    location_messages=True,
    contact_messages=True
)

# åˆ›å»ºè‡ªå®šä¹‰ WhatsApp æ¥å£
whatsapp_interface = Whatsapp(
    agent=image_agent,
    config=whatsapp_config
)
```

### 2. å¤šæ™ºèƒ½ä½“ WhatsApp é›†æˆ

```python
from agno.agent import Agent
from agno.team import Team
from agno.os.interfaces.whatsapp import Whatsapp

# åˆ›å»ºä¸“é—¨çš„æ™ºèƒ½ä½“
customer_service_agent = Agent(
    name="å®¢æœåŠ©æ‰‹",
    instructions="ä½ æ˜¯ä¸“ä¸šçš„å®¢æœä»£è¡¨ï¼Œå¤„ç†å®¢æˆ·å’¨è¯¢å’Œé—®é¢˜è§£å†³"
)

medical_agent = Agent(
    name="åŒ»ç–—åŠ©æ‰‹", 
    instructions="ä½ æ˜¯åŒ»ç–—å¥åº·ä¸“å®¶ï¼Œæä¾›å¥åº·å»ºè®®å’ŒåŒ»ç–—ä¿¡æ¯"
)

education_agent = Agent(
    name="æ•™è‚²åŠ©æ‰‹",
    instructions="ä½ æ˜¯æ•™è‚²ä¸“å®¶ï¼Œæä¾›å­¦ä¹ å»ºè®®å’ŒçŸ¥è¯†è§£ç­”"
)

# åˆ›å»ºæ™ºèƒ½ä½“å›¢é˜Ÿ
service_team = Team(
    agents=[customer_service_agent, medical_agent, education_agent],
    instructions="å›¢é˜Ÿåä½œä¸ºç”¨æˆ·æä¾›å…¨é¢çš„æœåŠ¡æ”¯æŒ"
)

# æ™ºèƒ½è·¯ç”±å™¨
class WhatsAppRouter:
    def __init__(self):
        self.agents = {
            "customer_service": customer_service_agent,
            "medical": medical_agent,
            "education": education_agent,
            "general": service_team
        }
    
    async def route_message(self, message, user_id):
        """æ ¹æ®æ¶ˆæ¯å†…å®¹è·¯ç”±åˆ°åˆé€‚çš„æ™ºèƒ½ä½“"""
        content = message.get("text", "").lower()
        
        if any(keyword in content for keyword in ["å®¢æœ", "æœåŠ¡", "æŠ•è¯‰", "é—®é¢˜"]):
            return self.agents["customer_service"]
        elif any(keyword in content for keyword in ["åŒ»ç–—", "å¥åº·", "ç—…ç—‡", "åŒ»ç”Ÿ"]):
            return self.agents["medical"]
        elif any(keyword in content for keyword in ["å­¦ä¹ ", "æ•™è‚²", "çŸ¥è¯†", "é—®é¢˜"]):
            return self.agents["education"]
        else:
            return self.agents["general"]

# åº”ç”¨æ™ºèƒ½è·¯ç”±
router = WhatsAppRouter()

class SmartWhatsappInterface(Whatsapp):
    async def process_message(self, message_data):
        """æ™ºèƒ½å¤„ç†æ¶ˆæ¯"""
        user_id = message_data.get("from")
        message = message_data.get("message", {})
        
        # è·¯ç”±åˆ°åˆé€‚çš„æ™ºèƒ½ä½“
        target_agent = await router.route_message(message, user_id)
        
        # å¤„ç†æ¶ˆæ¯
        response = await target_agent.run(
            message.get("text", ""),
            user_id=user_id,
            session_id=user_id  # ä½¿ç”¨ç”¨æˆ·IDä½œä¸ºä¼šè¯ID
        )
        
        return response

# åˆ›å»ºæ™ºèƒ½ WhatsApp æ¥å£
whatsapp_interface = SmartWhatsappInterface(agent=service_team)
```

### 3. è‡ªå®šä¹‰æ¶ˆæ¯å¤„ç†å™¨

```python
from agno.os.interfaces.whatsapp import MessageHandler

class CustomWhatsAppHandler(MessageHandler):
    async def handle_text_message(self, message_data):
        """å¤„ç†æ–‡æœ¬æ¶ˆæ¯"""
        text = message_data.get("text", {}).get("body", "")
        user_id = message_data.get("from")
        
        # æ£€æŸ¥æ˜¯å¦æ˜¯ç‰¹æ®Šå‘½ä»¤
        if text.startswith("/"):
            await self.handle_command(message_data)
        else:
            await super().handle_text_message(message_data)
    
    async def handle_command(self, message_data):
        """å¤„ç†å‘½ä»¤æ¶ˆæ¯"""
        command = message_data.get("text", {}).get("body", "").lower()
        user_id = message_data.get("from")
        
        if command == "/help":
            await self.send_help_menu(user_id)
        elif command == "/status":
            await self.send_service_status(user_id)
        elif command == "/menu":
            await self.send_interactive_menu(user_id)
        elif command == "/location":
            await self.request_location(user_id)
    
    async def send_help_menu(self, user_id):
        """å‘é€å¸®åŠ©èœå•"""
        help_text = """
        ğŸ¤– *æ™ºèƒ½åŠ©æ‰‹åŠŸèƒ½èœå•*
        
        ğŸ“ *æ–‡æœ¬æœåŠ¡*:
        â€¢ ç›´æ¥å‘é€æ¶ˆæ¯å¼€å§‹å¯¹è¯
        â€¢ å‘é€"/help"æŸ¥çœ‹æ­¤èœå•
        
        ğŸ–¼ï¸ *å›¾åƒæœåŠ¡*:
        â€¢ å‘é€å›¾ç‰‡è¿›è¡Œå›¾åƒåˆ†æ
        â€¢ æ”¯æŒJPGã€PNGã€GIFæ ¼å¼
        
        ğŸ“ *ä½ç½®æœåŠ¡*:
        â€¢ å‘é€"/location"åˆ†äº«ä½ç½®
        â€¢ è·å–åŸºäºä½ç½®çš„æ¨è
        
        ğŸ“ *å…¶ä»–åŠŸèƒ½*:
        â€¢ å‘é€"/status"æŸ¥çœ‹æœåŠ¡çŠ¶æ€
        â€¢ å‘é€"/menu"æŸ¥çœ‹äº¤äº’èœå•
        
        ğŸ’¡ *æç¤º*: æˆ‘å¯ä»¥å¤„ç†å¤šç§æ¶ˆæ¯ç±»å‹ï¼ŒåŒ…æ‹¬æ–‡æœ¬ã€å›¾ç‰‡ã€éŸ³é¢‘å’Œè§†é¢‘ï¼
        """
        
        await self.send_text_message(user_id, help_text)
    
    async def send_interactive_menu(self, user_id):
        """å‘é€äº¤äº’å¼èœå•"""
        interactive_message = {
            "type": "interactive",
            "interactive": {
                "type": "button",
                "body": {
                    "text": "ğŸ¯ è¯·é€‰æ‹©æ‚¨éœ€è¦çš„æœåŠ¡ï¼š"
                },
                "action": {
                    "buttons": [
                        {
                            "type": "reply",
                            "reply": {
                                "id": "customer_service",
                                "title": "ğŸ›ï¸ å®¢æœæ”¯æŒ"
                            }
                        },
                        {
                            "type": "reply",
                            "reply": {
                                "id": "image_analysis",
                                "title": "ğŸ–¼ï¸ å›¾åƒåˆ†æ"
                            }
                        },
                        {
                            "type": "reply",
                            "reply": {
                                "id": "general_assist",
                                "title": "ğŸ’¬ ä¸€èˆ¬å’¨è¯¢"
                            }
                        }
                    ]
                }
            }
        }
        
        await self.send_interactive_message(user_id, interactive_message)
    
    async def request_location(self, user_id):
        """è¯·æ±‚ç”¨æˆ·ä½ç½®"""
        location_request = {
            "type": "interactive",
            "interactive": {
                "type": "location_request_message",
                "body": {
                    "text": "ğŸ“ è¯·åˆ†äº«æ‚¨çš„ä½ç½®ï¼Œæˆ‘å°†ä¸ºæ‚¨æä¾›åŸºäºä½ç½®çš„ä¸ªæ€§åŒ–æœåŠ¡ã€‚"
                },
                "action": {
                    "name": "send_location"
                }
            }
        }
        
        await self.send_interactive_message(user_id, location_request)

# åº”ç”¨è‡ªå®šä¹‰æ¶ˆæ¯å¤„ç†å™¨
whatsapp_interface = Whatsapp(
    agent=image_agent,
    message_handler=CustomWhatsAppHandler()
)
```

## å¤šåª’ä½“å¤„ç†

### 1. å›¾åƒå¤„ç†

```python
from agno.os.interfaces.whatsapp import MediaHandler
import base64
import io
from PIL import Image

class WhatsAppImageHandler(MediaHandler):
    async def handle_image_message(self, message_data):
        """å¤„ç†å›¾åƒæ¶ˆæ¯"""
        media_id = message_data.get("message", {}).get("image", {}).get("id")
        user_id = message_data.get("from")
        
        # ä¸‹è½½å›¾åƒ
        image_data = await self.download_media(media_id)
        
        # åˆ†æå›¾åƒ
        analysis = await self.analyze_image(image_data, user_id)
        
        # å‘é€åˆ†æç»“æœ
        await self.send_text_message(user_id, analysis)
    
    async def analyze_image(self, image_data, user_id):
        """åˆ†æå›¾åƒå†…å®¹"""
        try:
            # å°†å›¾åƒè½¬æ¢ä¸ºé€‚åˆçš„æ ¼å¼
            image = Image.open(io.BytesIO(image_data))
            
            # ç”Ÿæˆå›¾åƒæè¿°
            analysis_prompt = """
            è¯·è¯¦ç»†æè¿°è¿™å¼ å›¾ç‰‡çš„å†…å®¹ï¼ŒåŒ…æ‹¬ï¼š
            1. å›¾ç‰‡ä¸­çš„ä¸»è¦å¯¹è±¡å’Œåœºæ™¯
            2. é¢œè‰²ã€é£æ ¼å’Œæ„å›¾ç‰¹ç‚¹
            3. å¯èƒ½çš„ç”¨é€”æˆ–æ„ä¹‰
            4. å¦‚æœæœ‰äººç‰©ï¼Œæè¿°äººç‰©çŠ¶æ€
            
            è¯·ç”¨ç®€æ´ã€å‡†ç¡®çš„ä¸­æ–‡å›ç­”ã€‚
            """
            
            # ä½¿ç”¨å¤šæ¨¡æ€æ™ºèƒ½ä½“åˆ†æå›¾åƒ
            response = await self.agent.run(
                analysis_prompt,
                images=[image_data],
                user_id=user_id
            )
            
            return f"ğŸ–¼ï¸ *å›¾åƒåˆ†æç»“æœ*\n\n{response.content}"
            
        except Exception as e:
            return f"âŒ å›¾åƒå¤„ç†å¤±è´¥ï¼š{str(e)}"
    
    async def process_image_with_ocr(self, image_data, user_id):
        """ä½¿ç”¨ OCR å¤„ç†å›¾åƒä¸­çš„æ–‡å­—"""
        ocr_prompt = """
        è¯·è¯†åˆ«å¹¶æå–å›¾ç‰‡ä¸­çš„æ‰€æœ‰æ–‡å­—å†…å®¹ã€‚
        å¦‚æœæœ‰è¡¨æ ¼ï¼Œè¯·ä¿æŒè¡¨æ ¼æ ¼å¼ã€‚
        å¦‚æœæœ‰å¤šä¸ªæ–‡æœ¬åŒºåŸŸï¼Œè¯·åˆ†åˆ«åˆ—å‡ºã€‚
        
        è¯·ç”¨ä¸­æ–‡å›å¤æå–çš„æ–‡å­—å†…å®¹ã€‚
        """
        
        response = await self.agent.run(
            ocr_prompt,
            images=[image_data],
            user_id=user_id
        )
        
        return f"ğŸ“ *å›¾ç‰‡æ–‡å­—è¯†åˆ«*\n\n{response.content}"

# åº”ç”¨å›¾åƒå¤„ç†å™¨
image_handler = WhatsAppImageHandler()
whatsapp_interface = Whatsapp(
    agent=image_agent,
    media_handler=image_handler
)
```

## æœ€ä½³å®è·µ

### 1. æ€§èƒ½ä¼˜åŒ–

- **å¼‚æ­¥å¤„ç†**: ä½¿ç”¨å¼‚æ­¥æ“ä½œå¤„ç† WhatsApp webhook
- **åª’ä½“ç¼“å­˜**: ç¼“å­˜ä¸‹è½½çš„åª’ä½“æ–‡ä»¶
- **è¿æ¥æ± **: å¤ç”¨ HTTP å®¢æˆ·ç«¯è¿æ¥
- **æ‰¹é‡æ“ä½œ**: æ‰¹é‡å¤„ç†æ¶ˆæ¯å‘é€

### 2. ç”¨æˆ·ä½“éªŒ

- **å¿«é€Ÿå“åº”**: åœ¨24å°æ—¶å†…å›å¤æ‰€æœ‰æ¶ˆæ¯
- **ä¸ªæ€§åŒ–**: è®°ä½ç”¨æˆ·åå¥½å’Œå¯¹è¯å†å²
- **å¤šåª’ä½“æ”¯æŒ**: æ”¯æŒå„ç§æ¶ˆæ¯ç±»å‹
- **æ™ºèƒ½è·¯ç”±**: æ ¹æ®å†…å®¹ç±»å‹æ™ºèƒ½åˆ†é…å¤„ç†

### 3. åˆè§„æ€§

- **æ¶ˆæ¯æ¨¡æ¿**: ä½¿ç”¨ç»è¿‡æ‰¹å‡†çš„æ¶ˆæ¯æ¨¡æ¿
- **ç”¨æˆ·åŒæ„**: ç¡®ä¿è·å¾—é€‚å½“çš„ç”¨æˆ·åŒæ„
- **æ•°æ®ä¿æŠ¤**: ä¿æŠ¤ç”¨æˆ·éšç§å’Œæ•°æ®å®‰å…¨
- **24å°æ—¶è§„åˆ™**: éµå®ˆWhatsAppçš„24å°æ—¶æ¶ˆæ¯å‘é€è§„åˆ™

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### Webhook éªŒè¯å¤±è´¥

**é—®é¢˜**: WhatsApp webhook éªŒè¯å¤±è´¥
**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ `WHATSAPP_VERIFY_TOKEN` é…ç½®
2. ç¡®è®¤ webhook URL å¯è®¿é—®
3. éªŒè¯éªŒè¯é€»è¾‘æ­£ç¡®

#### æ¶ˆæ¯å‘é€å¤±è´¥

**é—®é¢˜**: æ¶ˆæ¯æ— æ³•å‘é€ç»™ç”¨æˆ·
**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ä¸»åŠ¨å‘é€è¿‡æ¶ˆæ¯
2. éªŒè¯æ˜¯å¦åœ¨24å°æ—¶æ—¶é—´çª—å£å†…
3. ç¡®è®¤æ¶ˆæ¯æ¨¡æ¿æ˜¯å¦ç»è¿‡æ‰¹å‡†

## ä¸‹ä¸€æ­¥

- æŸ¥çœ‹[A2A æ¥å£](/agent-os/interfaces/a2a/introduction)
- äº†è§£[AG-UI æ¥å£](/agent-os/interfaces/ag-ui/introduction)
- æ¢ç´¢[Slack æ¥å£](/agent-os/interfaces/slack/introduction)
- æŸ¥çœ‹[AgentOS é…ç½®](/agent-os/config)